"use strict";!function(){angular.module("cityTalk",["ui.router","ngStorage"])}();
"use strict";!function(){function t(t,r){r.otherwise("/start"),t.state("start",{url:"/start",templateUrl:"views/start.html",controller:"startController as start"}).state("find",{url:"/find",templateUrl:"views/find.html",controller:"findChatController as find"}).state("chat",{url:"/chat",templateUrl:"views/chat.html",controller:"chatController as chat",params:{data:null}})}angular.module("cityTalk").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
"use strict";!function(){angular.module("cityTalk").constant("citytalkApiUrl","http://localhost:3000/").constant("geoApiUrl","https://maps.googleapis.com/maps/api/geocode/json?latlng=")}();
"use strict";!function(){function t(t,e){var o=this;o.userName=e.userName||"",o.setValidUserName=function(t){var a=t.replace(/(<([^>]+)>)/gi,"");o.userName=a,e.userName=a},o.setNameAndChangeState=function(e){o.setValidUserName(e),t.go("find")}}function e(t,e,o,a,r){var n=this;n.locationDenied=!1,n.locationError="",n.userName=o.userName||"",n.userLocation="world",n.userPreferredLocation="world",n.userLabel="",n.init=function(){""===n.userName?t.go("start"):n.setCity()},n.setCity=function(){a.getCity().then(function(t){n.userLocation=t,n.locationError=""}).catch(function(t){console.log(t),n.locationError="Allow using location to find your city",n.locationDenied=!0})},n.startChat=function(){e.post(r+"findchat",{userName:n.userName,userLocation:"world"===n.userPreferredLocation?"world":n.userLocation,userLabel:""===n.userLabel?"label":n.userLabel.trim()}).then(function(e){t.go("chat",{data:{room:e.data.room,status:e.data.status,userName:n.userName,userLocation:n.userLocation}})})},n.init()}function o(t,e,o,a){var r=this;r.init=function(){t.params.data?(r.userName=t.params.data.userName,r.userLocation=t.params.data.userLocation,r.room=t.params.data.room,r.message="",r.chatStarted=!1,a.init(),a.on("connect",function(){a.emit("join room","userRoom_"+r.room)}),a.on("start",function(t){r.chatStarted=!0}),a.on("chat message",function(t){e.$broadcast("citytalk:incoming-msg",t)})):t.go("find")},r.init(),r.sendMessage=function(){var t={user:r.userName,text:r.message};a.emit("chat message",t),r.message=""}}angular.module("cityTalk").controller("startController",t).controller("findChatController",e).controller("chatController",o),t.$inject=["$state","$localStorage"],e.$inject=["$state","$http","$localStorage","locationService","citytalkApiUrl"],o.$inject=["$state","$scope","$rootScope","socketService"]}();
"use strict";!function(){function e(){return{templateUrl:"views/components/header.html",bindings:{userName:"@",userLocation:"@"}}}function n(){return{templateUrl:"views/components/start-form.html",controller:t,bindings:{setNameAndChangeState:"&",userName:"@"}}}function t(){var e=this;e.isNameValid=function(e){return e.trim().length}}function s(){return{templateUrl:"views/components/find-form.html",bindings:{startChat:"&",locationDenied:"<",label:"=",preferredLocation:"="}}}function a(){return{templateUrl:"views/components/chat-form.html",controller:o,bindings:{message:"=",chatStarted:"<",sendMessage:"&",userName:"@"}}}function o(e,n){var t=this;t.chatBox=n.find("#chat-box"),e.$on("citytalk:incoming-msg",function(e,n){t.addIncomingMessage(n)}),t.sendOutMessage=function(){t.message.length>0&&(t.addOutgoingMessage(),t.sendMessage())},t.addIncomingMessage=function(e){var n=new Date;n=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds(),t.chatBox.append('<p class="msg msg--in">\n                    <span class="msg__user text-info">'+e.user+'</span>\n                    <span class="msg__text">'+e.text+'</span>\n                    <span class="msg__time text-info">'+n+"</span>\n                </p>"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight},t.addOutgoingMessage=function(){var e=new Date;e=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),t.chatBox.append('<p class="msg msg--out">\n                    <span class="msg__user text-info">'+t.userName+'</span>\n                    <span class="msg__text">'+t.message+'</span>\n                    <span class="msg__time text-info">'+e+"</span>\n                </p>"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight}}angular.module("cityTalk").component("startForm",n()).component("findForm",s()).component("cityTalkHeader",e()).component("chatForm",a()),o.$inject=["$scope","$element"]}();
"use strict";!function(){function n(n,t,o){var i=this;i.getCity=function(){function i(t){n({url:o+t.coords.latitude+"%2C"+t.coords.longitude+"&language=en"}).then(function(n){var t=n.data.results,o="world";for(var i in t)if("locality"===t[i].address_components[0].types[0]){o=t[i].address_components[0].long_name;break}r.resolve(o)})}function e(n){r.reject(n)}if(!navigator.geolocation)return!1;var r=t.defer();return navigator.geolocation.getCurrentPosition(i,e),r.promise}}function t(n){var t=this,o={};t.init=function(){o=io()},t.on=function(t,i){o.on(t,function(){var t=arguments;n.$apply(function(){i.apply(o,t)})})},t.emit=function(t,i,e){o.emit(t,i,function(){var t=arguments;n.$apply(function(){e&&e.apply(o,t)})})}}angular.module("cityTalk").service("locationService",n).service("socketService",t),n.$inject=["$http","$q","geoApiUrl"],t.$inject=["$rootScope"]}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNpdHl0YWxrLm1vZHVsZS5qcyIsImNpdHl0YWxrLnJvdXRlcy5qcyIsImNsaWVudC5jb25mLmpzIiwiY29udHJvbGxlcnMvY2l0eXRhbGsuY29udHJvbGxlcnMuanMiLCJjb21wb25lbnRzL2NpdHl0YWxrLmNvbXBvbmVudHMuanMiLCJzZXJ2aWNlcy9jaXR5dGFsay5zZXJ2aWNlcy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiUm91dGVzQ29uZmlnIiwiJHN0YXRlUHJvdmlkZSIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicGFyYW1zIiwiZGF0YSIsImNvbmZpZyIsIiRpbmplY3QiLCJjb25zdGFudCIsInNlbGYiLCJ1c2VyTmFtZSIsIiRsb2NhbFN0b3JhZ2UiLCJ0aGlzIiwic2V0VmFsaWRVc2VyTmFtZSIsInZhbGlkTmFtZSIsIiRzdGF0ZSIsIm5hbWUiLCJnbyIsImxvY2F0aW9uRXJyb3IiLCIkaHR0cCIsImxvY2F0aW9uU2VydmljZSIsImNpdHl0YWxrQXBpVXJsIiwidXNlckxvY2F0aW9uIiwidXNlclByZWZlcnJlZExvY2F0aW9uIiwidXNlckxhYmVsIiwiaW5pdCIsInNldENpdHkiLCJnZXRDaXR5IiwiY29uc29sZSIsInJlc3VsdCIsImxvY2F0aW9uRGVuaWVkIiwiY2F0Y2giLCJlcnIiLCJsb2ciLCJzdGFydENoYXQiLCJwb3N0Iiwicm9vbSIsInJlc3BvbnNlRGF0YSIsInN0YXR1cyIsInRoZW4iLCJzb2NrZXRTZXJ2aWNlIiwiZW1pdCIsIm1lc3NhZ2UiLCJvbiIsIm1zZyIsImNoYXRTdGFydGVkIiwibXNnRGF0YSIsInVzZXIiLCJzZW5kTWVzc2FnZSIsInRleHQiLCJzdGFydENvbnRyb2xsZXIiLCJmaW5kQ2hhdENvbnRyb2xsZXIiLCJjaGF0Q29udHJvbGxlciIsImJpbmRpbmdzIiwic2V0TmFtZUFuZENoYW5nZVN0YXRlIiwiaXNOYW1lVmFsaWQiLCJ0cmltIiwibGVuZ3RoIiwibGFiZWwiLCJwcmVmZXJyZWRMb2NhdGlvbiIsImNoYXRCb3giLCIkc2NvcGUiLCIkZWxlbWVudCIsImZpbmQiLCIkb24iLCJldmVudCIsImFkZEluY29taW5nTWVzc2FnZSIsImFkZE91dGdvaW5nTWVzc2FnZSIsImRhdGUiLCJEYXRlIiwiYXBwZW5kIiwiZ2V0TWludXRlcyIsImdldFNlY29uZHMiLCJzY3JvbGxUb3AiLCJzY3JvbGxIZWlnaHQiLCJnZXRIb3VycyIsImNvbXBvbmVudCIsInN0YXJ0Rm9ybUNvbXBvbmVudCIsImNpdHlUYWxrSGVhZGVyQ29tcG9uZW50IiwiY2hhdEZvcm1Db21wb25lbnRDb250cm9sbGVyIiwiJHEiLCJnZW9BcGlVcmwiLCJuYXZpZ2F0b3IiLCJwb3NpdGlvbiIsInJlc3BvbnNlIiwiY29vcmRzIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJyZXNwb25zZVJlc3VsdHMiLCJyZXN1bHRzIiwiY2l0eSIsImkiLCJhZGRyZXNzX2NvbXBvbmVudHMiLCJ0eXBlcyIsImxvbmdfbmFtZSIsImRlZmZlcmVkIiwicmVzb2x2ZSIsImVycm9yIiwicmVqZWN0IiwiZ2VvbG9jYXRpb24iLCJzdWNjZXNzIiwicHJvbWlzZSIsIiRyb290U2NvcGUiLCJzb2NrZXQiLCJpbyIsIiRhcHBseSIsImNhbGxiYWNrIiwiYXBwbHkiLCJhcmdzIiwiYXJndW1lbnRzIiwic2VydmljZSJdLCJtYXBwaW5ncyI6ImNBQUEsV0FFSUEsUUFBQUMsT0FBQSxZQUFBLFlBQUE7Y0NGSixXQU9JQyxRQUFBQSxHQUFBQyxFQUF3QkMsR0FDeEJBLEVBQ0lBLFVBQUFBLFVBR0FELEVBRUtFLE1BQU0sU0FDSEMsSUFBSyxTQUNMQyxZQUFhLG1CQUNiQyxXQUFZLDZCQUlmSCxNQUFNLFFBQ0hDLElBQUssUUFDTEMsWUFBYSxrQkFDYkMsV0FBWSwrQkFJZkgsTUFBTSxRQUNIQyxJQUFLLFFBQ0xDLFlBQWEsa0JBQ2JDLFdBQVkseUJBQ1pDLFFBQ0lDLEtBQU0sUUEvQnRCVixRQUFB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QUtnQixLQUFPLFdBSVpoQixFQUFVK0YsTUFHRkYsRUFBQUEsR0FBQUEsU0FBQUEsRUFBV0csR0FDUEMsRUFBQUEsR0FBQUEsRUFBU0MsV0FDWixHQUZEQyxHQUFBQyxTQUZKUCxHQUFBRyxPQUFBLFdBREpDLEVBQUFDLE1BQUFKLEVBQUFLLFFBWVFOLEVBQUFBLEtBQUFBLFNBQUFBLEVBQVdHLEVBQU9DLEdBQ2RILEVBQUE5RCxLQUFJaUUsRUFBVXJHLEVBQUEsV0FDVnFHLEdBQUFBLEdBQUFBLFNBQ0hKLEdBQUFHLE9BQUEsV0FITEMsR0FGSkEsRUFBQUMsTUFBQUosRUFBQUssUUExRVJqSCxRQUFBQyxPQUFBLFlBR0trSCxRQUFRLGtCQUFtQjFGLEdBRGhDekIsUUFBUUMsZ0JBQ0hrSCxHQVFMMUYsRUFBU0EsU0FBZ0JELFFBQVc4RCxLQUFBQSxhQStDaEN6QyxFQUFJK0QsU0FBSiIsImZpbGUiOiJjaXR5dGFsay5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJywgWyd1aS5yb3V0ZXInLCAnbmdTdG9yYWdlJ10pO1xuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnY2l0eVRhbGsnKVxuICAgICAgICAuY29uZmlnKFJvdXRlc0NvbmZpZyk7XG5cbiAgICBSb3V0ZXNDb25maWcuJGluamVjdCA9IFsnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJ107XG4gICAgZnVuY3Rpb24gUm91dGVzQ29uZmlnKCRzdGF0ZVByb3ZpZGUsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXJcbiAgICAgICAgICAgIC5vdGhlcndpc2UoJy9zdGFydCcpO1xuXG4gICAgICAgICRzdGF0ZVByb3ZpZGVcbiAgICAgICAgICAgIC8vIFN0YXJ0IHNjcmVlbiwgd2hlcmUgdXNlciBlbnRlcnMgaGlzIG5hbWVcbiAgICAgICAgICAgIC5zdGF0ZSgnc3RhcnQnLCB7XG4gICAgICAgICAgICAgICAgdXJsOiAnL3N0YXJ0JyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3N0YXJ0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdzdGFydENvbnRyb2xsZXIgYXMgc3RhcnQnXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAvLyBGaW5kIHNjcmVlbiwgd2hlcmUgbG9jYXRpb24gaXMgZGV0ZXJtaW5lZCBhbmQgdXNlciBhZGRzIGxhYmVsIGZvciBjaGF0XG4gICAgICAgICAgICAuc3RhdGUoJ2ZpbmQnLCB7XG4gICAgICAgICAgICAgICAgdXJsOiAnL2ZpbmQnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvZmluZC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnZmluZENoYXRDb250cm9sbGVyIGFzIGZpbmQnXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAvLyBDaGF0IHN0YXRlXG4gICAgICAgICAgICAuc3RhdGUoJ2NoYXQnLCB7XG4gICAgICAgICAgICAgICAgdXJsOiAnL2NoYXQnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvY2hhdC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnY2hhdENvbnRyb2xsZXIgYXMgY2hhdCcsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IG51bGxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdjaXR5VGFsaycpXG4gICAgICAgIC5jb25zdGFudCgnY2l0eXRhbGtBcGlVcmwnLCAnaHR0cDovL2xvY2FsaG9zdDozMDAwLycpXG4gICAgICAgIC8vIC5jb25zdGFudCgnY2l0eXRhbGtBcGlVcmwnLCAnaHR0cHM6Ly9jaXR5dGFsay5oZXJva3VhcHAuY29tLycpXG4gICAgICAgIC5jb25zdGFudCgnZ2VvQXBpVXJsJywgJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24/bGF0bG5nPScpO1xuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnY2l0eVRhbGsnKVxuICAgICAgICAuY29udHJvbGxlcignc3RhcnRDb250cm9sbGVyJywgc3RhcnRDb250cm9sbGVyKVxuICAgICAgICAuY29udHJvbGxlcignZmluZENoYXRDb250cm9sbGVyJywgZmluZENoYXRDb250cm9sbGVyKVxuICAgICAgICAuY29udHJvbGxlcignY2hhdENvbnRyb2xsZXInLCBjaGF0Q29udHJvbGxlcik7XG5cblxuICAgIC8qKlxuICAgICAqIFN0YXJ0IHNjcmVlbiBjb250cm9sbGVyXG4gICAgICovXG4gICAgc3RhcnRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzdGF0ZScsICckbG9jYWxTdG9yYWdlJ107XG4gICAgZnVuY3Rpb24gc3RhcnRDb250cm9sbGVyKCRzdGF0ZSwgJGxvY2FsU3RvcmFnZSkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi51c2VyTmFtZSA9ICRsb2NhbFN0b3JhZ2UudXNlck5hbWUgfHwgJyc7XG5cbiAgICAgICAgc2VsZi5zZXRWYWxpZFVzZXJOYW1lID0gKG5hbWUpID0+IHtcbiAgICAgICAgICAgIGxldCB2YWxpZE5hbWUgPSBuYW1lLnJlcGxhY2UoLyg8KFtePl0rKT4pL2lnLCBcIlwiKTtcbiAgICAgICAgICAgIHNlbGYudXNlck5hbWUgPSB2YWxpZE5hbWU7XG4gICAgICAgICAgICAkbG9jYWxTdG9yYWdlLnVzZXJOYW1lID0gdmFsaWROYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuc2V0TmFtZUFuZENoYW5nZVN0YXRlID0gKG5hbWUpID0+IHtcbiAgICAgICAgICAgIHNlbGYuc2V0VmFsaWRVc2VyTmFtZShuYW1lKTtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnZmluZCcpO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBGaW5kIHNjcmVlbiBjb250cm9sbGVyXG4gICAgICovXG4gICAgZmluZENoYXRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzdGF0ZScsICckaHR0cCcsICckbG9jYWxTdG9yYWdlJywgJ2xvY2F0aW9uU2VydmljZScsICdjaXR5dGFsa0FwaVVybCddO1xuICAgIGZ1bmN0aW9uIGZpbmRDaGF0Q29udHJvbGxlcigkc3RhdGUsICRodHRwLCAkbG9jYWxTdG9yYWdlLCBsb2NhdGlvblNlcnZpY2UsIGNpdHl0YWxrQXBpVXJsKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICBzZWxmLmxvY2F0aW9uRGVuaWVkID0gZmFsc2U7XG4gICAgICAgIHNlbGYubG9jYXRpb25FcnJvciA9ICcnO1xuICAgICAgICBzZWxmLnVzZXJOYW1lID0gJGxvY2FsU3RvcmFnZS51c2VyTmFtZSB8fCAnJztcbiAgICAgICAgc2VsZi51c2VyTG9jYXRpb24gPSAnd29ybGQnO1xuICAgICAgICBzZWxmLnVzZXJQcmVmZXJyZWRMb2NhdGlvbiA9ICd3b3JsZCc7XG4gICAgICAgIHNlbGYudXNlckxhYmVsID0gJyc7XG5cbiAgICAgICAgLy9DaGVjayBpZiB1c2VybmFtZSBzZXQgYW5kIGxvY2F0ZSBjaXR5XG4gICAgICAgIHNlbGYuaW5pdCA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChzZWxmLnVzZXJOYW1lID09PSAnJykge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc3RhcnQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2VsZi5zZXRDaXR5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5zZXRDaXR5ID0gKCkgPT4ge1xuICAgICAgICAgICAgbG9jYXRpb25TZXJ2aWNlLmdldENpdHkoKVxuICAgICAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi51c2VyTG9jYXRpb24gPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9jYXRpb25FcnJvciA9ICcnO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2NhdGlvbkVycm9yID0gJ0FsbG93IHVzaW5nIGxvY2F0aW9uIHRvIGZpbmQgeW91ciBjaXR5JztcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2NhdGlvbkRlbmllZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5zdGFydENoYXQgPSAoKSA9PiB7XG4gICAgICAgICAgICAkaHR0cC5wb3N0KGNpdHl0YWxrQXBpVXJsICsgJ2ZpbmRjaGF0Jywge1xuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBzZWxmLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgIHVzZXJMb2NhdGlvbjogKHNlbGYudXNlclByZWZlcnJlZExvY2F0aW9uID09PSAnd29ybGQnKSA/XG4gICAgICAgICAgICAgICAgICAgICd3b3JsZCcgOiBzZWxmLnVzZXJMb2NhdGlvbixcbiAgICAgICAgICAgICAgICB1c2VyTGFiZWw6IChzZWxmLnVzZXJMYWJlbCA9PT0gJycpID9cbiAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJyA6IHNlbGYudXNlckxhYmVsLnRyaW0oKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2VEYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnY2hhdCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29tOiByZXNwb25zZURhdGEuZGF0YS5yb29tLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2VEYXRhLmRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBzZWxmLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJMb2NhdGlvbjogc2VsZi51c2VyTG9jYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5pbml0KCk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBDaGF0IGNvbnRyb2xsZXJcbiAgICAgKi9cbiAgICBjaGF0Q29udHJvbGxlci4kaW5qZWN0ID0gWyckc3RhdGUnLCAnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnc29ja2V0U2VydmljZSddO1xuICAgIGZ1bmN0aW9uIGNoYXRDb250cm9sbGVyKCRzdGF0ZSwgJHNjb3BlLCAkcm9vdFNjb3BlLCBzb2NrZXRTZXJ2aWNlKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8vaW5pdFxuICAgICAgICBzZWxmLmluaXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoISRzdGF0ZS5wYXJhbXMuZGF0YSkge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnZmluZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWxmLnVzZXJOYW1lID0gJHN0YXRlLnBhcmFtcy5kYXRhLnVzZXJOYW1lO1xuICAgICAgICAgICAgICAgIHNlbGYudXNlckxvY2F0aW9uID0gJHN0YXRlLnBhcmFtcy5kYXRhLnVzZXJMb2NhdGlvbjtcbiAgICAgICAgICAgICAgICBzZWxmLnJvb20gPSAkc3RhdGUucGFyYW1zLmRhdGEucm9vbTtcbiAgICAgICAgICAgICAgICBzZWxmLm1lc3NhZ2UgPSAnJztcbiAgICAgICAgICAgICAgICBzZWxmLmNoYXRTdGFydGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLmluaXQoKTtcbiAgICAgICAgICAgICAgICAvLyBDb25uZWN0XG4gICAgICAgICAgICAgICAgc29ja2V0U2VydmljZS5vbignY29ubmVjdCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29ubmVjdGVkLCBsZXQncyBzaWduLXVwIGZvciB0byByZWNlaXZlIG1lc3NhZ2VzIGZvciB0aGlzIHJvb21cbiAgICAgICAgICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KCdqb2luIHJvb20nLCAndXNlclJvb21fJyArIHNlbGYucm9vbSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gU3RhcnQgY2hhdChib3RoIHBhcnRuZXJzIGNvbm5lY3RlZClcbiAgICAgICAgICAgICAgICBzb2NrZXRTZXJ2aWNlLm9uKCdzdGFydCcsIChtc2cpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jaGF0U3RhcnRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gUmVjZWl2ZSBtZXNzYWdlXG4gICAgICAgICAgICAgICAgc29ja2V0U2VydmljZS5vbignY2hhdCBtZXNzYWdlJywgKG1zZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY2l0eXRhbGs6aW5jb21pbmctbXNnJywgbXNnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgc2VsZi5pbml0KCk7XG5cbiAgICAgICAgLy8gU2VuZCBtZXNzYWdlXG4gICAgICAgIHNlbGYuc2VuZE1lc3NhZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtc2dEYXRhID0ge1xuICAgICAgICAgICAgICAgIHVzZXI6IHNlbGYudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgdGV4dDogc2VsZi5tZXNzYWdlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc29ja2V0U2VydmljZS5lbWl0KCdjaGF0IG1lc3NhZ2UnLCBtc2dEYXRhKTtcbiAgICAgICAgICAgIHNlbGYubWVzc2FnZSA9ICcnO1xuICAgICAgICB9O1xuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLmNvbXBvbmVudCgnc3RhcnRGb3JtJywgc3RhcnRGb3JtQ29tcG9uZW50KCkpXG4gICAgICAgIC5jb21wb25lbnQoJ2ZpbmRGb3JtJywgZmluZEZvcm1Db21wb25lbnQoKSlcbiAgICAgICAgLmNvbXBvbmVudCgnY2l0eVRhbGtIZWFkZXInLCBjaXR5VGFsa0hlYWRlckNvbXBvbmVudCgpKVxuICAgICAgICAuY29tcG9uZW50KCdjaGF0Rm9ybScsIGNoYXRGb3JtQ29tcG9uZW50KCkpO1xuXG4gICAgZnVuY3Rpb24gY2l0eVRhbGtIZWFkZXJDb21wb25lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NvbXBvbmVudHMvaGVhZGVyLmh0bWwnLFxuICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogJ0AnLFxuICAgICAgICAgICAgICAgIHVzZXJMb2NhdGlvbjogJ0AnXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdGFydEZvcm1Db21wb25lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NvbXBvbmVudHMvc3RhcnQtZm9ybS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IHN0YXJ0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIsXG4gICAgICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgICAgIHNldE5hbWVBbmRDaGFuZ2VTdGF0ZTogJyYnLFxuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiAnQCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN0YXJ0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIoKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICBzZWxmLmlzTmFtZVZhbGlkID0gKG5hbWUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuYW1lLnRyaW0oKS5sZW5ndGg7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZmluZEZvcm1Db21wb25lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NvbXBvbmVudHMvZmluZC1mb3JtLmh0bWwnLFxuICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICBzdGFydENoYXQ6ICcmJyxcbiAgICAgICAgICAgICAgICBsb2NhdGlvbkRlbmllZDogJzwnLFxuICAgICAgICAgICAgICAgIGxhYmVsOiAnPScsXG4gICAgICAgICAgICAgICAgcHJlZmVycmVkTG9jYXRpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2hhdEZvcm1Db21wb25lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NvbXBvbmVudHMvY2hhdC1mb3JtLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogY2hhdEZvcm1Db21wb25lbnRDb250cm9sbGVyLFxuICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnPScsXG4gICAgICAgICAgICAgICAgY2hhdFN0YXJ0ZWQ6ICc8JyxcbiAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZTogJyYnLFxuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiAnQCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNoYXRGb3JtQ29tcG9uZW50Q29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJGVsZW1lbnQnXTtcbiAgICBmdW5jdGlvbiBjaGF0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIoJHNjb3BlLCAkZWxlbWVudCkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi5jaGF0Qm94ID0gJGVsZW1lbnQuZmluZCgnI2NoYXQtYm94Jyk7XG5cbiAgICAgICAgJHNjb3BlLiRvbignY2l0eXRhbGs6aW5jb21pbmctbXNnJywgKGV2ZW50LCBkYXRhKSA9PiB7XG4gICAgICAgICAgICBzZWxmLmFkZEluY29taW5nTWVzc2FnZShkYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2VsZi5zZW5kT3V0TWVzc2FnZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChzZWxmLm1lc3NhZ2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNlbGYuYWRkT3V0Z29pbmdNZXNzYWdlKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZW5kTWVzc2FnZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuYWRkSW5jb21pbmdNZXNzYWdlID0gKG1zZykgPT4ge1xuICAgICAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgZGF0ZSA9IGAke2RhdGUuZ2V0SG91cnMoKX06JHtkYXRlLmdldE1pbnV0ZXMoKX06JHtkYXRlLmdldFNlY29uZHMoKX1gO1xuXG4gICAgICAgICAgICBzZWxmLmNoYXRCb3guYXBwZW5kKFxuICAgICAgICAgICAgICAgIGA8cCBjbGFzcz1cIm1zZyBtc2ctLWluXCI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibXNnX191c2VyIHRleHQtaW5mb1wiPiR7bXNnLnVzZXJ9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1zZ19fdGV4dFwiPiR7bXNnLnRleHR9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1zZ19fdGltZSB0ZXh0LWluZm9cIj4ke2RhdGV9PC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvcD5gXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgc2VsZi5jaGF0Qm94WzBdLnNjcm9sbFRvcCA9IHNlbGYuY2hhdEJveFswXS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5hZGRPdXRnb2luZ01lc3NhZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICBkYXRlID0gYCR7ZGF0ZS5nZXRIb3VycygpfToke2RhdGUuZ2V0TWludXRlcygpfToke2RhdGUuZ2V0U2Vjb25kcygpfWA7XG5cbiAgICAgICAgICAgIHNlbGYuY2hhdEJveC5hcHBlbmQoXG4gICAgICAgICAgICAgICAgYDxwIGNsYXNzPVwibXNnIG1zZy0tb3V0XCI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibXNnX191c2VyIHRleHQtaW5mb1wiPiR7c2VsZi51c2VyTmFtZX08L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibXNnX190ZXh0XCI+JHtzZWxmLm1lc3NhZ2V9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1zZ19fdGltZSB0ZXh0LWluZm9cIj4ke2RhdGV9PC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvcD5gXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgc2VsZi5jaGF0Qm94WzBdLnNjcm9sbFRvcCA9IHNlbGYuY2hhdEJveFswXS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIH07XG4gICAgfVxuXG59KSgpO1xuXG4iLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLnNlcnZpY2UoJ2xvY2F0aW9uU2VydmljZScsIGxvY2F0aW9uU2VydmljZSlcbiAgICAgICAgLnNlcnZpY2UoJ3NvY2tldFNlcnZpY2UnLCBzb2NrZXRTZXJ2aWNlKTtcblxuXG4gICAgLyoqXG4gICAgICogTG9jYXRpb24gc2VydmljZVxuICAgICAqL1xuICAgIGxvY2F0aW9uU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdnZW9BcGlVcmwnXTtcbiAgICBmdW5jdGlvbiBsb2NhdGlvblNlcnZpY2UoJGh0dHAsICRxLCBnZW9BcGlVcmwpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBjbGllbnQgY2l0eSBiYXNlZCBvbiBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24gYW5kIGdvb2dsZSBnZW9BcGlcbiAgICAgICAgICpcbiAgICAgICAgICogQHJldHVybnMgcHJvbWlzZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5nZXRDaXR5ID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgZGVmZmVyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbihzdWNjZXNzLCBlcnJvcik7XG4gICAgICAgICAgICBmdW5jdGlvbiBzdWNjZXNzKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICggZ2VvQXBpVXJsICsgcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlICsgJyUyQycgK1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlICsgJyZsYW5ndWFnZT1lbicgKVxuICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZpbmQgY2l0eSBuYW1lIGluIHVub3JkZXJlZCByZXN1bHRzIGFycmF5XG4gICAgICAgICAgICAgICAgICAgIGxldCByZXNwb25zZVJlc3VsdHMgPSByZXNwb25zZS5kYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjaXR5ID0gJ3dvcmxkJztcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSBpbiByZXNwb25zZVJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZVJlc3VsdHNbaV0uYWRkcmVzc19jb21wb25lbnRzWzBdLnR5cGVzWzBdID09PSAnbG9jYWxpdHknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2l0eSA9IHJlc3BvbnNlUmVzdWx0c1tpXS5hZGRyZXNzX2NvbXBvbmVudHNbMF0ubG9uZ19uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlc29sdmUoY2l0eSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGVycm9yKGVycikge1xuICAgICAgICAgICAgICAgIGRlZmZlcmVkLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZGVmZmVyZWQucHJvbWlzZTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogc29ja2V0U2VydmljZVxuICAgICAqL1xuICAgIHNvY2tldFNlcnZpY2UuJGluamVjdCA9IFsnJHJvb3RTY29wZSddO1xuICAgIGZ1bmN0aW9uIHNvY2tldFNlcnZpY2UoJHJvb3RTY29wZSkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgbGV0IHNvY2tldCA9IHt9O1xuXG4gICAgICAgIHNlbGYuaW5pdCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNvY2tldCA9IGlvKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5vbiA9IChldmVudE5hbWUsIGNhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgICBzb2NrZXQub24oZXZlbnROYW1lLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5lbWl0ID0gKGV2ZW50TmFtZSwgZGF0YSwgY2FsbGJhY2spID0+IHtcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5hcHBseShzb2NrZXQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9O1xuICAgIH1cblxufSkoKTsiXX0=
