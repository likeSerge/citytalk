"use strict";!function(){angular.module("cityTalk",["ui.router"])}();
"use strict";!function(){function t(t,r){r.otherwise("/start"),t.state("start",{url:"/start",templateUrl:"views/start.html",controller:"startController as start"}).state("find",{url:"/find",templateUrl:"views/find.html",controller:"findChatController as find"}).state("chat",{url:"/chat",templateUrl:"views/chat.html",controller:"chatController as chat",params:{data:null}})}angular.module("cityTalk").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
"use strict";!function(){angular.module("cityTalk").constant("citytalkApiUrl","http://localhost:3000/").constant("geoApiUrl","https://maps.googleapis.com/maps/api/geocode/json?latlng=")}();
"use strict";!function(){function o(o){var e=this;e.userName=localStorage.userName||"",e.setUserName=function(e){localStorage.userName=e.replace(/(<([^>]+)>)/gi,""),o.go("find")}}function e(o,e,t,a){var r=this;r.locationDenied=!1,r.userName=localStorage.userName||"",r.userLocation="world",r.userPreferredLocation="world",r.userLabel="",r.init=function(){""===r.userName&&o.go("start"),r.setCity()},r.setCity=function(){t.getCity().then(function(o){r.userLocation=o,r.locationError=""}).catch(function(o){console.log(o),r.locationError="Allow using location to find your city",r.locationDenied=!0})},r.startChat=function(){console.log("start chat"),console.log("userName",r.userName),console.log("location",r.userLocation),console.log("userPreferredLocation",r.userPreferredLocation),console.log("label",r.userLabel),e.post(a+"findchat",{userName:r.userName,userLocation:"world"===r.userPreferredLocation?"world":r.userLocation,userLabel:""===r.userLabel?"label":r.userLabel.trim()}).then(function(e){console.log(e.data),o.go("chat",{data:{room:e.data.room,status:e.data.status,userName:r.userName,userLocation:r.userLocation}})})},r.init()}function t(o,e,t){var a=this;o.params.data||o.go("find"),a.userName=o.params.data.userName,a.userLocation=o.params.data.userLocation,a.room=o.params.data.room,a.message="",a.chatStarted=!1;var r=io();r.on("connect",function(){r.emit("join room","userRoom_"+a.room)}),r.on("start",function(o){e.$apply(function(){a.chatStarted=!0})}),a.sendMessage=function(){console.log("sendmesage",a.message);var o={user:a.userName,text:a.message};r.emit("chat message",o),a.message=""},r.on("chat message",function(o){console.log("message: "+o),e.$broadcast("citytalk:incoming-msg",o)})}angular.module("cityTalk").controller("startController",o).controller("findChatController",e).controller("chatController",t),o.$inject=["$state"],e.$inject=["$state","$http","locationService","citytalkApiUrl"],t.$inject=["$state","$scope","$rootScope"]}();
"use strict";!function(){function e(){return{templateUrl:"views/components/header.html",bindings:{userName:"@",userLocation:"@"}}}function n(){return{templateUrl:"views/components/start-form.html",controller:t,bindings:{setUserName:"&",userName:"@"}}}function t(){var e=this;e.isNameValid=function(e){return e.trim().length}}function s(){return{templateUrl:"views/components/find-form.html",bindings:{startChat:"&",locationDenied:"<",label:"=",preferredLocation:"="}}}function a(){return{templateUrl:"views/components/chat-form.html",controller:o,bindings:{message:"=",chatStarted:"<",sendMessage:"&",userName:"@"}}}function o(e,n){var t=this;t.chatBox=n.find("#chat-box"),e.$on("citytalk:incoming-msg",function(e,n){t.addIncomingMessage(n)}),t.sendOutMessage=function(){t.message.length>0&&(t.addOutgoingMessage(),t.sendMessage())},t.addIncomingMessage=function(e){var n=new Date;n=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds(),t.chatBox.append('<p class="msg msg--in">\n                    <span class="msg__user text-info">'+e.user+'</span>\n                    <span class="msg__text">'+e.text+'</span>\n                    <span class="msg__time text-info">'+n+"</span>\n                </p>"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight},t.addOutgoingMessage=function(){var e=new Date;e=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),t.chatBox.append('<p class="msg msg--out">\n                    <span class="msg__user text-info">'+t.userName+'</span>\n                    <span class="msg__text">'+t.message+'</span>\n                    <span class="msg__time text-info">'+e+"</span>\n                </p>"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight}}angular.module("cityTalk").component("startForm",n()).component("findForm",s()).component("cityTalkHeader",e()).component("chatForm",a()),o.$inject=["$scope","$element"]}();
"use strict";!function(){function t(t,e,o){var n=this;n.getCity=function(){function n(e){t({url:o+e.coords.latitude+"%2C"+e.coords.longitude+"&language=en"}).then(function(t){var e=t.data.results,o="world";for(var n in e)if("locality"===e[n].address_components[0].types[0]){o=e[n].address_components[0].long_name;break}i.resolve(o)})}function r(t){i.reject(t)}if(!navigator.geolocation)return!1;var i=e.defer();return navigator.geolocation.getCurrentPosition(n,r),i.promise}}angular.module("cityTalk").service("locationService",t),t.$inject=["$http","$q","geoApiUrl"]}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNpdHl0YWxrLm1vZHVsZS5qcyIsImNpdHl0YWxrLnJvdXRlcy5qcyIsImNsaWVudC5jb25mLmpzIiwiY29udHJvbGxlcnMvY2l0eXRhbGsuY29udHJvbGxlcnMuanMiLCJjb21wb25lbnRzL2NpdHl0YWxrLmNvbXBvbmVudHMuanMiLCJzZXJ2aWNlcy9jaXR5dGFsay5zZXJ2aWNlcy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiUm91dGVzQ29uZmlnIiwiJHN0YXRlUHJvdmlkZSIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicGFyYW1zIiwiZGF0YSIsImNvbmZpZyIsIiRpbmplY3QiLCJjb25zdGFudCIsInNlbGYiLCJ1c2VyTmFtZSIsImxvY2FsU3RvcmFnZSIsInRoaXMiLCJzZXRVc2VyTmFtZSIsIm5hbWUiLCIkc3RhdGUiLCJyZXBsYWNlIiwiZ28iLCJsb2NhdGlvblNlcnZpY2UiLCJjaXR5dGFsa0FwaVVybCIsInVzZXJMb2NhdGlvbiIsInVzZXJQcmVmZXJyZWRMb2NhdGlvbiIsInVzZXJMYWJlbCIsImluaXQiLCJzZXRDaXR5IiwibG9jYXRpb25FcnJvciIsImdldENpdHkiLCJjb25zb2xlIiwicmVzdWx0IiwibG9jYXRpb25EZW5pZWQiLCJjYXRjaCIsImVyciIsImxvZyIsInN0YXJ0Q2hhdCIsIiRodHRwIiwicG9zdCIsInJlc3BvbnNlRGF0YSIsInJvb20iLCJzdGF0dXMiLCJ0aGVuIiwiJHJvb3RTY29wZSIsIm1lc3NhZ2UiLCJzb2NrZXQiLCJpbyIsImNoYXRTdGFydGVkIiwiZW1pdCIsIm1zZyIsIiRzY29wZSIsIm1zZ0RhdGEiLCJ1c2VyIiwib24iLCIkYnJvYWRjYXN0Iiwic3RhcnRDb250cm9sbGVyIiwiZmluZENoYXRDb250cm9sbGVyIiwiY2hhdENvbnRyb2xsZXIiLCJiaW5kaW5ncyIsImlzTmFtZVZhbGlkIiwidHJpbSIsImxlbmd0aCIsImxhYmVsIiwicHJlZmVycmVkTG9jYXRpb24iLCJzZW5kTWVzc2FnZSIsImNoYXRCb3giLCIkZWxlbWVudCIsImZpbmQiLCIkb24iLCJldmVudCIsImFkZEluY29taW5nTWVzc2FnZSIsImFkZE91dGdvaW5nTWVzc2FnZSIsImRhdGUiLCJEYXRlIiwiYXBwZW5kIiwiZ2V0TWludXRlcyIsImdldFNlY29uZHMiLCJ0ZXh0Iiwic2Nyb2xsVG9wIiwic2Nyb2xsSGVpZ2h0IiwiZ2V0SG91cnMiLCJjb21wb25lbnQiLCJzdGFydEZvcm1Db21wb25lbnQiLCJjaXR5VGFsa0hlYWRlckNvbXBvbmVudCIsImNoYXRGb3JtQ29tcG9uZW50Q29udHJvbGxlciIsIiRxIiwiZ2VvQXBpVXJsIiwic3VjY2VzcyIsInBvc2l0aW9uIiwiY29vcmRzIiwibGF0aXR1ZGUiLCJyZXNwb25zZSIsImNpdHkiLCJyZXN1bHRzIiwicmVzcG9uc2VSZXN1bHRzIiwibG9uZ19uYW1lIiwiYWRkcmVzc19jb21wb25lbnRzIiwiaSIsImRlZmZlcmVkIiwicmVzb2x2ZSIsInJlamVjdCIsIm5hdmlnYXRvciIsImdlb2xvY2F0aW9uIiwiZGVmZXIiLCJnZXRDdXJyZW50UG9zaXRpb24iLCJlcnJvciIsInByb21pc2UiLCJzZXJ2aWNlIl0sIm1hcHBpbmdzIjoiY0FBQSxXQUVJQSxRQUFBQyxPQUFBLFlBQUE7Y0NGSixXQU9JQyxRQUFBQSxHQUFBQyxFQUF3QkMsR0FDeEJBLEVBQ0lBLFVBQUFBLFVBR0FELEVBRUtFLE1BQU0sU0FDSEMsSUFBSyxTQUNMQyxZQUFhLG1CQUNiQyxXQUFZLDZCQUlmSCxNQUFNLFFBQ0hDLElBQUssUUFDTEMsWUFBYSxrQkFDYkMsV0FBWSwrQkFJZkgsTUFBTSxRQUNIQyxJQUFLLFFBQ0xDLFlBQWEsa0JBQ2JDLFdBQVkseUJBQ1pDLFFBQ0lDLEtBQU0sUUEvQnRCVixRQUFBQyxPQUFBLFlBR0tVLE9BQU9ULEdBRVpBLEVBQWFVLFNBQVcsaUJBQWtCO2NDUDlDLFdBRUlaLFFBQUFDLE9BQUEsWUFHS1ksU0FBUyxp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UUFBUyxLQUFNIiwiZmlsZSI6ImNpdHl0YWxrLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnY2l0eVRhbGsnLCBbJ3VpLnJvdXRlciddKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLmNvbmZpZyhSb3V0ZXNDb25maWcpO1xuXG4gICAgUm91dGVzQ29uZmlnLiRpbmplY3QgPSBbJyRzdGF0ZVByb3ZpZGVyJywgJyR1cmxSb3V0ZXJQcm92aWRlciddO1xuICAgIGZ1bmN0aW9uIFJvdXRlc0NvbmZpZygkc3RhdGVQcm92aWRlLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyXG4gICAgICAgICAgICAub3RoZXJ3aXNlKCcvc3RhcnQnKTtcblxuICAgICAgICAkc3RhdGVQcm92aWRlXG4gICAgICAgICAgICAvLyBTdGFydCBzY3JlZW4sIHdoZXJlIHVzZXIgZW50ZXJzIGhpcyBuYW1lXG4gICAgICAgICAgICAuc3RhdGUoJ3N0YXJ0Jywge1xuICAgICAgICAgICAgICAgIHVybDogJy9zdGFydCcsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9zdGFydC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnc3RhcnRDb250cm9sbGVyIGFzIHN0YXJ0J1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy8gRmluZCBzY3JlZW4sIHdoZXJlIGxvY2F0aW9uIGlzIGRldGVybWluZWQgYW5kIHVzZXIgYWRkcyBsYWJlbCBmb3IgY2hhdFxuICAgICAgICAgICAgLnN0YXRlKCdmaW5kJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9maW5kJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2ZpbmQuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2ZpbmRDaGF0Q29udHJvbGxlciBhcyBmaW5kJ1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy8gQ2hhdCBzdGF0ZVxuICAgICAgICAgICAgLnN0YXRlKCdjaGF0Jywge1xuICAgICAgICAgICAgICAgIHVybDogJy9jaGF0JyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NoYXQuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2NoYXRDb250cm9sbGVyIGFzIGNoYXQnLFxuICAgICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnY2l0eVRhbGsnKVxuICAgICAgICAuY29uc3RhbnQoJ2NpdHl0YWxrQXBpVXJsJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC8nKVxuICAgICAgICAvLyAuY29uc3RhbnQoJ2NpdHl0YWxrQXBpVXJsJywgJ2h0dHBzOi8vY2l0eXRhbGsuaGVyb2t1YXBwLmNvbS8nKVxuICAgICAgICAuY29uc3RhbnQoJ2dlb0FwaVVybCcsICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uP2xhdGxuZz0nKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3N0YXJ0Q29udHJvbGxlcicsIHN0YXJ0Q29udHJvbGxlcilcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2ZpbmRDaGF0Q29udHJvbGxlcicsIGZpbmRDaGF0Q29udHJvbGxlcilcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2NoYXRDb250cm9sbGVyJywgY2hhdENvbnRyb2xsZXIpO1xuXG5cbiAgICAvKipcbiAgICAgKiBTdGFydCBzY3JlZW4gY29udHJvbGxlclxuICAgICAqL1xuICAgIHN0YXJ0Q29udHJvbGxlci4kaW5qZWN0ID0gWyckc3RhdGUnXTtcbiAgICBmdW5jdGlvbiBzdGFydENvbnRyb2xsZXIoJHN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICBzZWxmLnVzZXJOYW1lID0gbG9jYWxTdG9yYWdlLnVzZXJOYW1lIHx8ICcnO1xuXG4gICAgICAgIHNlbGYuc2V0VXNlck5hbWUgPSAobmFtZSkgPT4ge1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnVzZXJOYW1lID0gbmFtZS5yZXBsYWNlKC8oPChbXj5dKyk+KS9pZywgXCJcIik7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2ZpbmQnKTtcbiAgICAgICAgfTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEZpbmQgc2NyZWVuIGNvbnRyb2xsZXJcbiAgICAgKi9cbiAgICBmaW5kQ2hhdENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHN0YXRlJywgJyRodHRwJywgJ2xvY2F0aW9uU2VydmljZScsICdjaXR5dGFsa0FwaVVybCddO1xuICAgIGZ1bmN0aW9uIGZpbmRDaGF0Q29udHJvbGxlcigkc3RhdGUsICRodHRwLCBsb2NhdGlvblNlcnZpY2UsIGNpdHl0YWxrQXBpVXJsKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgICAgICBzZWxmLmxvY2F0aW9uRGVuaWVkID0gZmFsc2U7XG4gICAgICAgIHNlbGYudXNlck5hbWUgPSBsb2NhbFN0b3JhZ2UudXNlck5hbWUgfHwgJyc7XG4gICAgICAgIHNlbGYudXNlckxvY2F0aW9uID0gJ3dvcmxkJztcbiAgICAgICAgc2VsZi51c2VyUHJlZmVycmVkTG9jYXRpb24gPSAnd29ybGQnO1xuICAgICAgICBzZWxmLnVzZXJMYWJlbCA9ICcnO1xuXG4gICAgICAgIC8vQ2hlY2sgaWYgdXNlcm5hbWUgc2V0IGFuZCBsb2NhdGUgY2l0eVxuICAgICAgICBzZWxmLmluaXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoc2VsZi51c2VyTmFtZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3N0YXJ0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLnNldENpdHkoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLnNldENpdHkgPSAoKSA9PiB7XG4gICAgICAgICAgICBsb2NhdGlvblNlcnZpY2UuZ2V0Q2l0eSgpXG4gICAgICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnVzZXJMb2NhdGlvbiA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2NhdGlvbkVycm9yID0gJyc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvY2F0aW9uRXJyb3IgPSAnQWxsb3cgdXNpbmcgbG9jYXRpb24gdG8gZmluZCB5b3VyIGNpdHknO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvY2F0aW9uRGVuaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLnN0YXJ0Q2hhdCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdGFydCBjaGF0Jyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygndXNlck5hbWUnLCBzZWxmLnVzZXJOYW1lKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2NhdGlvbicsIHNlbGYudXNlckxvY2F0aW9uKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2VyUHJlZmVycmVkTG9jYXRpb24nLCBzZWxmLnVzZXJQcmVmZXJyZWRMb2NhdGlvbik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbGFiZWwnLCBzZWxmLnVzZXJMYWJlbCk7XG5cbiAgICAgICAgICAgICRodHRwLnBvc3QoY2l0eXRhbGtBcGlVcmwgKyAnZmluZGNoYXQnLCB7XG4gICAgICAgICAgICAgICAgdXNlck5hbWU6IHNlbGYudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgdXNlckxvY2F0aW9uOiAoc2VsZi51c2VyUHJlZmVycmVkTG9jYXRpb24gPT09ICd3b3JsZCcpID9cbiAgICAgICAgICAgICAgICAgICAgJ3dvcmxkJyA6IHNlbGYudXNlckxvY2F0aW9uLFxuICAgICAgICAgICAgICAgIHVzZXJMYWJlbDogKHNlbGYudXNlckxhYmVsID09PSAnJykgP1xuICAgICAgICAgICAgICAgICAgICAnbGFiZWwnIDogc2VsZi51c2VyTGFiZWwudHJpbSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKChyZXNwb25zZURhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2VEYXRhLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2NoYXQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vbTogcmVzcG9uc2VEYXRhLmRhdGEucm9vbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlRGF0YS5kYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogc2VsZi51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTG9jYXRpb246IHNlbGYudXNlckxvY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuaW5pdCgpO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogQ2hhdCBjb250cm9sbGVyXG4gICAgICovXG4gICAgY2hhdENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHN0YXRlJywgJyRzY29wZScsICckcm9vdFNjb3BlJ107XG4gICAgZnVuY3Rpb24gY2hhdENvbnRyb2xsZXIoJHN0YXRlLCAkc2NvcGUsICRyb290U2NvcGUpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCEkc3RhdGUucGFyYW1zLmRhdGEpIHtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnZmluZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgc2VsZi51c2VyTmFtZSA9ICRzdGF0ZS5wYXJhbXMuZGF0YS51c2VyTmFtZTtcbiAgICAgICAgc2VsZi51c2VyTG9jYXRpb24gPSAkc3RhdGUucGFyYW1zLmRhdGEudXNlckxvY2F0aW9uO1xuICAgICAgICBzZWxmLnJvb20gPSAkc3RhdGUucGFyYW1zLmRhdGEucm9vbTtcbiAgICAgICAgc2VsZi5tZXNzYWdlID0gJyc7XG4gICAgICAgIHNlbGYuY2hhdFN0YXJ0ZWQgPSBmYWxzZTtcblxuICAgICAgICB2YXIgc29ja2V0ID0gaW8oKTtcbiAgICAgICAgLy8gQ29ubmVjdFxuICAgICAgICBzb2NrZXQub24oJ2Nvbm5lY3QnLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBDb25uZWN0ZWQsIGxldCdzIHNpZ24tdXAgZm9yIHRvIHJlY2VpdmUgbWVzc2FnZXMgZm9yIHRoaXMgcm9vbVxuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2pvaW4gcm9vbScsICd1c2VyUm9vbV8nICsgc2VsZi5yb29tKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU3RhcnQgY2hhdChib3RoIHBhcnRuZXJzIGNvbm5lY3RlZClcbiAgICAgICAgc29ja2V0Lm9uKCdzdGFydCcsIChtc2cpID0+IHtcbiAgICAgICAgICAgIC8vIE5vbi1hbmd1bGFyIGV2ZW50LCBjYWxsICRhcHBseVxuICAgICAgICAgICAgJHNjb3BlLiRhcHBseSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2VsZi5jaGF0U3RhcnRlZCA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gU2VuZCBtZXNzYWdlXG4gICAgICAgIHNlbGYuc2VuZE1lc3NhZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2VuZG1lc2FnZScsIHNlbGYubWVzc2FnZSk7XG5cbiAgICAgICAgICAgIHZhciBtc2dEYXRhID0ge1xuICAgICAgICAgICAgICAgIHVzZXI6IHNlbGYudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgdGV4dDogc2VsZi5tZXNzYWdlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzb2NrZXQuZW1pdCgnY2hhdCBtZXNzYWdlJywgbXNnRGF0YSk7XG4gICAgICAgICAgICBzZWxmLm1lc3NhZ2UgPSAnJztcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBSZWNlaXZlIG1lc3NhZ2VcbiAgICAgICAgc29ja2V0Lm9uKCdjaGF0IG1lc3NhZ2UnLCAobXNnKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbWVzc2FnZTogJyArIG1zZyk7XG4gICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnY2l0eXRhbGs6aW5jb21pbmctbXNnJywgbXNnKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnY2l0eVRhbGsnKVxuICAgICAgICAuY29tcG9uZW50KCdzdGFydEZvcm0nLCBzdGFydEZvcm1Db21wb25lbnQoKSlcbiAgICAgICAgLmNvbXBvbmVudCgnZmluZEZvcm0nLCBmaW5kRm9ybUNvbXBvbmVudCgpKVxuICAgICAgICAuY29tcG9uZW50KCdjaXR5VGFsa0hlYWRlcicsIGNpdHlUYWxrSGVhZGVyQ29tcG9uZW50KCkpXG4gICAgICAgIC5jb21wb25lbnQoJ2NoYXRGb3JtJywgY2hhdEZvcm1Db21wb25lbnQoKSk7XG5cbiAgICBmdW5jdGlvbiBjaXR5VGFsa0hlYWRlckNvbXBvbmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvY29tcG9uZW50cy9oZWFkZXIuaHRtbCcsXG4gICAgICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiAnQCcsXG4gICAgICAgICAgICAgICAgdXNlckxvY2F0aW9uOiAnQCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN0YXJ0Rm9ybUNvbXBvbmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvY29tcG9uZW50cy9zdGFydC1mb3JtLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogc3RhcnRGb3JtQ29tcG9uZW50Q29udHJvbGxlcixcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICAgICAgc2V0VXNlck5hbWU6ICcmJyxcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogJ0AnXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdGFydEZvcm1Db21wb25lbnRDb250cm9sbGVyKCkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi5pc05hbWVWYWxpZCA9IChuYW1lKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmFtZS50cmltKCkubGVuZ3RoO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGZpbmRGb3JtQ29tcG9uZW50KCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jb21wb25lbnRzL2ZpbmQtZm9ybS5odG1sJyxcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICAgICAgc3RhcnRDaGF0OiAnJicsXG4gICAgICAgICAgICAgICAgbG9jYXRpb25EZW5pZWQ6ICc8JyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJz0nLFxuICAgICAgICAgICAgICAgIHByZWZlcnJlZExvY2F0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoYXRGb3JtQ29tcG9uZW50KCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jb21wb25lbnRzL2NoYXQtZm9ybS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGNoYXRGb3JtQ29tcG9uZW50Q29udHJvbGxlcixcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJz0nLFxuICAgICAgICAgICAgICAgIGNoYXRTdGFydGVkOiAnPCcsXG4gICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2U6ICcmJyxcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogJ0AnXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjaGF0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRlbGVtZW50J107XG4gICAgZnVuY3Rpb24gY2hhdEZvcm1Db21wb25lbnRDb250cm9sbGVyKCRzY29wZSwgJGVsZW1lbnQpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNlbGYuY2hhdEJveCA9ICRlbGVtZW50LmZpbmQoJyNjaGF0LWJveCcpO1xuXG4gICAgICAgICRzY29wZS4kb24oJ2NpdHl0YWxrOmluY29taW5nLW1zZycsIChldmVudCwgZGF0YSkgPT4ge1xuICAgICAgICAgICAgc2VsZi5hZGRJbmNvbWluZ01lc3NhZ2UoZGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNlbGYuc2VuZE91dE1lc3NhZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoc2VsZi5tZXNzYWdlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBzZWxmLmFkZE91dGdvaW5nTWVzc2FnZSgpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2VuZE1lc3NhZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmFkZEluY29taW5nTWVzc2FnZSA9IChtc2cpID0+IHtcbiAgICAgICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGRhdGUgPSBgJHtkYXRlLmdldEhvdXJzKCl9OiR7ZGF0ZS5nZXRNaW51dGVzKCl9OiR7ZGF0ZS5nZXRTZWNvbmRzKCl9YDtcblxuICAgICAgICAgICAgc2VsZi5jaGF0Qm94LmFwcGVuZChcbiAgICAgICAgICAgICAgICBgPHAgY2xhc3M9XCJtc2cgbXNnLS1pblwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1zZ19fdXNlciB0ZXh0LWluZm9cIj4ke21zZy51c2VyfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtc2dfX3RleHRcIj4ke21zZy50ZXh0fTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtc2dfX3RpbWUgdGV4dC1pbmZvXCI+JHtkYXRlfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L3A+YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHNlbGYuY2hhdEJveFswXS5zY3JvbGxUb3AgPSBzZWxmLmNoYXRCb3hbMF0uc2Nyb2xsSGVpZ2h0O1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuYWRkT3V0Z29pbmdNZXNzYWdlID0gKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgZGF0ZSA9IGAke2RhdGUuZ2V0SG91cnMoKX06JHtkYXRlLmdldE1pbnV0ZXMoKX06JHtkYXRlLmdldFNlY29uZHMoKX1gO1xuXG4gICAgICAgICAgICBzZWxmLmNoYXRCb3guYXBwZW5kKFxuICAgICAgICAgICAgICAgIGA8cCBjbGFzcz1cIm1zZyBtc2ctLW91dFwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1zZ19fdXNlciB0ZXh0LWluZm9cIj4ke3NlbGYudXNlck5hbWV9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1zZ19fdGV4dFwiPiR7c2VsZi5tZXNzYWdlfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtc2dfX3RpbWUgdGV4dC1pbmZvXCI+JHtkYXRlfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L3A+YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHNlbGYuY2hhdEJveFswXS5zY3JvbGxUb3AgPSBzZWxmLmNoYXRCb3hbMF0uc2Nyb2xsSGVpZ2h0O1xuICAgICAgICB9O1xuICAgIH1cblxufSkoKTtcblxuIiwiKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdjaXR5VGFsaycpXG4gICAgICAgIC5zZXJ2aWNlKCdsb2NhdGlvblNlcnZpY2UnLCBsb2NhdGlvblNlcnZpY2UpO1xuXG5cbiAgICAvKipcbiAgICAgKiBMb2NhdGlvbiBzZXJ2aWNlXG4gICAgICovXG4gICAgbG9jYXRpb25TZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2dlb0FwaVVybCddO1xuICAgIGZ1bmN0aW9uIGxvY2F0aW9uU2VydmljZSgkaHR0cCwgJHEsIGdlb0FwaVVybCkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IGNsaWVudCBjaXR5IGJhc2VkIG9uIG5hdmlnYXRvci5nZW9sb2NhdGlvbiBhbmQgZ29vZ2xlIGdlb0FwaVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcmV0dXJucyBwcm9taXNlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldENpdHkgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIW5hdmlnYXRvci5nZW9sb2NhdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBkZWZmZXJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKHN1Y2Nlc3MsIGVycm9yKTtcbiAgICAgICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MocG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogKCBnZW9BcGlVcmwgKyBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUgKyAnJTJDJyArXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUgKyAnJmxhbmd1YWdlPWVuJyApXG4gICAgICAgICAgICAgICAgfSkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmluZCBjaXR5IG5hbWUgaW4gdW5vcmRlcmVkIHJlc3VsdHMgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlUmVzdWx0cyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNpdHkgPSAnd29ybGQnO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpIGluIHJlc3BvbnNlUmVzdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlUmVzdWx0c1tpXS5hZGRyZXNzX2NvbXBvbmVudHNbMF0udHlwZXNbMF0gPT09ICdsb2NhbGl0eScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaXR5ID0gcmVzcG9uc2VSZXN1bHRzW2ldLmFkZHJlc3NfY29tcG9uZW50c1swXS5sb25nX25hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZGVmZmVyZWQucmVzb2x2ZShjaXR5KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3IoZXJyKSB7XG4gICAgICAgICAgICAgICAgZGVmZmVyZWQucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZmZXJlZC5wcm9taXNlO1xuICAgICAgICB9XG4gICAgfVxuXG5cbn0pKCk7Il19
