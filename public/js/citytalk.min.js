"use strict";!function(){angular.module("cityTalk",["ui.router","ngStorage"])}();
"use strict";!function(){function t(t,r){r.otherwise("/start"),t.state("start",{url:"/start",templateUrl:"views/start.html",controller:"startController as start"}).state("find",{url:"/find",templateUrl:"views/find.html",controller:"findChatController as find"}).state("chat",{url:"/chat",templateUrl:"views/chat.html",controller:"chatController as chat",params:{data:null}})}angular.module("cityTalk").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
"use strict";!function(){angular.module("cityTalk").constant("citytalkApiUrl","http://localhost:3000/").constant("geoApiUrl","https://maps.googleapis.com/maps/api/geocode/json?latlng=")}();
"use strict";!function(){function e(e,o){var t=this;t.userName=o.userName||"",t.setValidUserName=function(e){var a=e.replace(/(<([^>]+)>)/gi,"");t.userName=a,o.userName=a},t.setNameAndChangeState=function(o){t.setValidUserName(o),e.go("find")}}function o(e,o,t,a){var r=this;r.locationDenied=!1,r.userName=localStorage.userName||"",r.userLocation="world",r.userPreferredLocation="world",r.userLabel="",r.init=function(){""===r.userName&&e.go("start"),r.setCity()},r.setCity=function(){t.getCity().then(function(e){r.userLocation=e,r.locationError=""}).catch(function(e){console.log(e),r.locationError="Allow using location to find your city",r.locationDenied=!0})},r.startChat=function(){console.log("start chat"),console.log("userName",r.userName),console.log("location",r.userLocation),console.log("userPreferredLocation",r.userPreferredLocation),console.log("label",r.userLabel),o.post(a+"findchat",{userName:r.userName,userLocation:"world"===r.userPreferredLocation?"world":r.userLocation,userLabel:""===r.userLabel?"label":r.userLabel.trim()}).then(function(o){console.log(o.data),e.go("chat",{data:{room:o.data.room,status:o.data.status,userName:r.userName,userLocation:r.userLocation}})})},r.init()}function t(e,o,t){var a=this;e.params.data||e.go("find"),a.userName=e.params.data.userName,a.userLocation=e.params.data.userLocation,a.room=e.params.data.room,a.message="",a.chatStarted=!1;var r=io();r.on("connect",function(){r.emit("join room","userRoom_"+a.room)}),r.on("start",function(e){o.$apply(function(){a.chatStarted=!0})}),a.sendMessage=function(){console.log("sendmesage",a.message);var e={user:a.userName,text:a.message};r.emit("chat message",e),a.message=""},r.on("chat message",function(e){console.log("message: "+e),o.$broadcast("citytalk:incoming-msg",e)})}angular.module("cityTalk").controller("startController",e).controller("findChatController",o).controller("chatController",t),e.$inject=["$state","$localStorage"],o.$inject=["$state","$http","locationService","citytalkApiUrl"],t.$inject=["$state","$scope","$rootScope"]}();
"use strict";!function(){function e(){return{templateUrl:"views/components/header.html",bindings:{userName:"@",userLocation:"@"}}}function n(){return{templateUrl:"views/components/start-form.html",controller:t,bindings:{setNameAndChangeState:"&",userName:"@"}}}function t(){var e=this;e.isNameValid=function(e){return e.trim().length}}function s(){return{templateUrl:"views/components/find-form.html",bindings:{startChat:"&",locationDenied:"<",label:"=",preferredLocation:"="}}}function a(){return{templateUrl:"views/components/chat-form.html",controller:o,bindings:{message:"=",chatStarted:"<",sendMessage:"&",userName:"@"}}}function o(e,n){var t=this;t.chatBox=n.find("#chat-box"),e.$on("citytalk:incoming-msg",function(e,n){t.addIncomingMessage(n)}),t.sendOutMessage=function(){t.message.length>0&&(t.addOutgoingMessage(),t.sendMessage())},t.addIncomingMessage=function(e){var n=new Date;n=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds(),t.chatBox.append('<p class="msg msg--in">\n                    <span class="msg__user text-info">'+e.user+'</span>\n                    <span class="msg__text">'+e.text+'</span>\n                    <span class="msg__time text-info">'+n+"</span>\n                </p>"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight},t.addOutgoingMessage=function(){var e=new Date;e=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),t.chatBox.append('<p class="msg msg--out">\n                    <span class="msg__user text-info">'+t.userName+'</span>\n                    <span class="msg__text">'+t.message+'</span>\n                    <span class="msg__time text-info">'+e+"</span>\n                </p>"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight}}angular.module("cityTalk").component("startForm",n()).component("findForm",s()).component("cityTalkHeader",e()).component("chatForm",a()),o.$inject=["$scope","$element"]}();
"use strict";!function(){function t(t,e,o){var n=this;n.getCity=function(){function n(e){t({url:o+e.coords.latitude+"%2C"+e.coords.longitude+"&language=en"}).then(function(t){var e=t.data.results,o="world";for(var n in e)if("locality"===e[n].address_components[0].types[0]){o=e[n].address_components[0].long_name;break}i.resolve(o)})}function r(t){i.reject(t)}if(!navigator.geolocation)return!1;var i=e.defer();return navigator.geolocation.getCurrentPosition(n,r),i.promise}}angular.module("cityTalk").service("locationService",t),t.$inject=["$http","$q","geoApiUrl"]}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNpdHl0YWxrLm1vZHVsZS5qcyIsImNpdHl0YWxrLnJvdXRlcy5qcyIsImNsaWVudC5jb25mLmpzIiwiY29udHJvbGxlcnMvY2l0eXRhbGsuY29udHJvbGxlcnMuanMiLCJjb21wb25lbnRzL2NpdHl0YWxrLmNvbXBvbmVudHMuanMiLCJzZXJ2aWNlcy9jaXR5dGFsay5zZXJ2aWNlcy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiUm91dGVzQ29uZmlnIiwiJHN0YXRlUHJvdmlkZSIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicGFyYW1zIiwiZGF0YSIsImNvbmZpZyIsIiRpbmplY3QiLCJjb25zdGFudCIsInNlbGYiLCJ1c2VyTmFtZSIsIiRsb2NhbFN0b3JhZ2UiLCJ0aGlzIiwic2V0VmFsaWRVc2VyTmFtZSIsInZhbGlkTmFtZSIsIiRzdGF0ZSIsIm5hbWUiLCJnbyIsImxvY2FsU3RvcmFnZSIsImxvY2F0aW9uU2VydmljZSIsImNpdHl0YWxrQXBpVXJsIiwidXNlckxvY2F0aW9uIiwidXNlclByZWZlcnJlZExvY2F0aW9uIiwidXNlckxhYmVsIiwiaW5pdCIsInNldENpdHkiLCJsb2NhdGlvbkVycm9yIiwiZ2V0Q2l0eSIsImNvbnNvbGUiLCJyZXN1bHQiLCJsb2NhdGlvbkRlbmllZCIsImNhdGNoIiwiZXJyIiwibG9nIiwic3RhcnRDaGF0IiwiJGh0dHAiLCJwb3N0IiwicmVzcG9uc2VEYXRhIiwicm9vbSIsInN0YXR1cyIsInRoZW4iLCIkcm9vdFNjb3BlIiwibWVzc2FnZSIsInNvY2tldCIsImlvIiwiY2hhdFN0YXJ0ZWQiLCJlbWl0IiwibXNnIiwiJHNjb3BlIiwibXNnRGF0YSIsInVzZXIiLCJvbiIsIiRicm9hZGNhc3QiLCJzdGFydENvbnRyb2xsZXIiLCJmaW5kQ2hhdENvbnRyb2xsZXIiLCJjaGF0Q29udHJvbGxlciIsImJpbmRpbmdzIiwic2V0TmFtZUFuZENoYW5nZVN0YXRlIiwiaXNOYW1lVmFsaWQiLCJ0cmltIiwibGVuZ3RoIiwibGFiZWwiLCJwcmVmZXJyZWRMb2NhdGlvbiIsInNlbmRNZXNzYWdlIiwiY2hhdEJveCIsIiRlbGVtZW50IiwiZmluZCIsIiRvbiIsImV2ZW50IiwiYWRkSW5jb21pbmdNZXNzYWdlIiwiYWRkT3V0Z29pbmdNZXNzYWdlIiwiZGF0ZSIsIkRhdGUiLCJhcHBlbmQiLCJnZXRNaW51dGVzIiwiZ2V0U2Vjb25kcyIsInRleHQiLCJzY3JvbGxUb3AiLCJzY3JvbGxIZWlnaHQiLCJnZXRIb3VycyIsImNvbXBvbmVudCIsInN0YXJ0Rm9ybUNvbXBvbmVudCIsImNpdHlUYWxrSGVhZGVyQ29tcG9uZW50IiwiY2hhdEZvcm1Db21wb25lbnRDb250cm9sbGVyIiwiJHEiLCJnZW9BcGlVcmwiLCJzdWNjZXNzIiwicG9zaXRpb24iLCJjb29yZHMiLCJsYXRpdHVkZSIsInJlc3BvbnNlIiwiY2l0eSIsInJlc3VsdHMiLCJyZXNwb25zZVJlc3VsdHMiLCJsb25nX25hbWUiLCJhZGRyZXNzX2NvbXBvbmVudHMiLCJpIiwiZGVmZmVyZWQiLCJyZXNvbHZlIiwicmVqZWN0IiwibmF2aWdhdG9yIiwiZ2VvbG9jYXRpb24iLCJkZWZlciIsImdldEN1cnJlbnRQb3NpdGlvbiIsImVycm9yIiwicHJvbWlzZSIsInNlcnZpY2UiXSwibWFwcGluZ3MiOiJjQUFBLFdBRUlBLFFBQUFDLE9BQUEsWUFBQSxZQUFBO2NDRkosV0FPSUMsUUFBQUEsR0FBQUMsRUFBd0JDLEdBQ3hCQSxFQUNJQSxVQUFBQSxVQUdBRCxFQUVLRSxNQUFNLFNBQ0hDLElBQUssU0FDTEMsWUFBYSxtQkFDYkMsV0FBWSw2QkFJZkgsTUFBTSxRQUNIQyxJQUFLLFFBQ0xDLFlBQWEsa0JBQ2JDLFdBQVksK0JBSWZILE1BQU0sUUFDSEMsSUFBSyxRQUNMQyxZQUFhLGtCQUNiQyxXQUFZLHlCQUNaQyxRQUNJQyxLQUFNLFFBL0J0QlYsUUFBQUMsT0FBQSxZQUdLVSxPQUFPVCxHQUVaQSxFQUFhVSxTQUFXLGlCQUFrQjtjQ1A5QyxXQUVJWixRQUFBQyxPQUFBLFlBR0tZLFNBQVMsaUJBQWtCLDBCQUM1QkEsU0FBQSxZQUFBO2NDTlIsV0FnQlFDLFFBQUtDLEdBQVdDLEVBQUFBLEdBRGhCLEdBQU1GLEdBQU9HLElBR2JILEdBQUtJLFNBQUFBLEVBQW1CSCxVQUFVLEdBRTlCRCxFQUFBQSxpQkFBZ0JLLFNBQUFBLEdBQ2hCSCxHQUFBQSxHQUFjRCxFQUFBQSxRQUFXSSxnQkFBekIsR0FISkwsR0FBQUMsU0FBQUksRUFHSUgsRUFBY0QsU0FBV0ksR0FLekJDLEVBQUFBLHNCQUFBLFNBQUFDLEdBRkpQLEVBQUFJLGlCQUFBRyxHQUlIRCxFQUFBRSxHQUFBLFNBVUdSLFFBQUtDLEdBQVdRLEVBQWFSLEVBQWJTLEVBQWhCQyxHQUNBWCxHQUFLWSxHQUFBQSxJQUNMWixHQUFLYSxnQkFBQUEsRUFDTGIsRUFBS2MsU0FBTEwsYUFBQVIsVUFBQSxHQUZBRCxFQUFLWSxhQUFlLFFBSXBCWixFQUFBYSxzQkFBQSxRQUNBYixFQUFLZSxVQUFPLEdBR1BmLEVBQUFlLEtBQUEsV0FDRCxLQUFBZixFQUFLZ0IsVUFKVFYsRUFBQUUsR0FBQSxTQU9BUixFQUFLZ0IsV0FJT2hCLEVBQUFBLFFBQUtpQixXQUNSUCxFQUNNUSxVQUNIQyxLQUFBQSxTQUFBQSxHQUNBbkIsRUFBS2lCLGFBQWdCRyxFQUNyQnBCLEVBQUtxQixjQUFpQixLQVRsQ0MsTUFBQSxTQUFBQyxHQU9ZSixRQUFRSyxJQUFJRCxHQU1uQkUsRUFBWVIsY0FBTSx5Q0FDWE8sRUFBSUgsZ0JBQVosS0FJQUYsRUFBQUEsVUFBWSxXQUpaQSxRQUFRSyxJQUFJLGNBTVpFLFFBQU1DLElBQUtoQixXQUFBQSxFQUFpQlYsVUFDeEJBLFFBQUFBLElBQUFBLFdBQWVBLEVBRHFCVyxjQUVwQ0EsUUFBQUEsSUFBQUEsd0JBQW9CQyxFQUFBQSx1QkFFcEJDLFFBQUFBLElBQUFBLFFBQWlCQSxFQUFBQSxXQUliSyxFQUFBQSxLQUFBQSxFQUFZUyxZQUNadEIsU0FBVU4sRUFBQUMsU0FDTkwsYUFBTSxVQUFBSSxFQUFBYSxzQkFDRmdCLFFBQU1ELEVBQUFBLGFBQ05FLFVBQXFCbEMsS0FBckJrQyxFQUFRRixVQUNSM0IsUUFBQUEsRUFBVUQsVUFBS0MsU0FIYjhCLEtBQUEsU0FBQUgsR0FEVlQsUUFBQUssSUFBQUksRUFBQWhDLE1BVFJVLEVBQUFFLEdBQUEsUUFQSlosTUFrQm9CaUMsS0FBTUQsRUFBYWhDLEtBQUtpQyxLQVM1Q0MsT0FBQUYsRUFBQWhDLEtBQUFrQyxPQUNIN0IsU0FBQUQsRUFBQUMsU0FQdUJXLGFBQWNaLEVBQUtZLG1CQWV2Q1osRUFBTUEsT0FRTkEsUUFBSzZCLEdBQWNsQyxFQUFPQyxFQUExQm9DLEdBQ0FoQyxHQUFLaUMsR0FBTDlCLElBUEtHLEdBQU9YLE9BQU9DLE1BVWZzQyxFQUFBQSxHQUFTQyxRQUdUbkMsRUFBQUMsU0FBQUssRUFBQVgsT0FBQUMsS0FBQUssU0FDQWlDLEVBQUFBLGFBQVk1QixFQUFaWCxPQUF5QkMsS0FBQWdCLGFBQzVCWixFQUhENkIsS0FBQXZCLEVBQUFYLE9BQUFDLEtBQUFpQyxLQUxBN0IsRUFBS2lDLFFBQVUsR0FVZmpDLEVBQUFvQyxhQUFBLENBRUksSUFBQUYsR0FBQUMsSUFFSW5DLEdBQUFBLEdBQUFBLFVBQUtvQyxXQUhiRixFQUFBRyxLQUFBLFlBQUEsWUFBQXJDLEVBQUE2QixRQVNJVixFQUFBQSxHQUFBQSxRQUFZLFNBQUFtQixHQUVaQyxFQUFJQyxPQUFVLFdBQ1ZDLEVBQUFBLGFBRFUsTUFNZHpDLEVBQUFBLFlBQWUsV0FUbkJtQixRQUFBSyxJQUFBLGFBQUF4QixFQUFBaUMsUUFZQSxJQUFBTyxJQUNPRSxLQUFHMUMsRUFBQUMsU0FDTmtCLEtBQVFLLEVBQUlTLFFBR25CQyxHQUFBRyxLQUFBLGVBQUFHLEdBakpMeEMsRUFBQWlDLFFBQUEsSUE2SVFDLEVBQU9RLEdBQUcsZUFBZ0IsU0FBQ0osR0FDdkJuQixRQUFRSyxJQUFJLFlBQWNjLEdBQzFCQyxFQUFPSSxXQUFXLHdCQUF5QkwsS0E3SW5EcEQsUUFBQUMsT0FBQSxZQUdLTyxXQUFXLGtCQUFtQmtELEdBRG5DMUQsV0FBZSxxQkFDQzJELEdBRVhuRCxXQUFXLGlCQUFrQm9ELEdBUTlCRixFQUFhOUMsU0FBYixTQUFBLGlCQXNCQUUsRUFBS3FCLFNBQWlCLFNBQXRCLFFBQUEsa0JBQUEsa0JBc0VBckIsRUFBS1ksU0FBZU4sU0FBT1gsU0FBWWlCO2NDM0cvQyxXQVlZbkIsUUFBQUEsS0FDQXNELE9BQ0k5QyxZQUFBQSwrQkFDQVcsVUFGTVgsU0FBQSxJQUZkVyxhQUFBLE1BV0luQixRQUFBQSxLQUNBQyxPQUNBcUQsWUFBVSxtQ0FDTkMsV0FBQUEsRUFDQS9DLFVBRk0rQyxzQkFBQSxJQUhkL0MsU0FBQSxNQVlBRCxRQUFLaUQsS0FDRCxHQUFBakQsR0FBT08sSUFDVlAsR0FGRGlELFlBQUEsU0FBQTFDLEdBR0gsTUFBQUEsR0FBQTJDLE9BQUFDLFFBSU8xRCxRQUFBQSxLQUNBc0QsT0FDSXRCLFlBQUFBLGtDQUNBSixVQUNBK0IsVUFITSxJQUlOQyxlQUFBQSxJQUpNRCxNQUFBLElBRmRDLGtCQUFBLE1BYUk1RCxRQUFBQSxLQUNBQyxPQUNBcUQsWUFBVSxrQ0FDTmQsV0FBQUEsRUFDQUcsVUFDQWtCLFFBQUFBLElBQ0FyRCxZQUFVLElBSkpxRCxZQUFBLElBSGRyRCxTQUFBLE1BZUFELFFBQUt1RCxHQUF3QmhCLEVBQTdCaUIsR0FEQSxHQUFNeEQsR0FBT0csSUFHYm9DLEdBQUFBLFFBQVdpQixFQUFBQyxLQUFBLGFBRVZsQixFQUZEbUIsSUFBQSx3QkFBQSxTQUFBQyxFQUFBL0QsR0FDSUksRUFBSzRELG1CQUFtQmhFLEtBS3BCSSxFQUFBQSxlQUFLNkQsV0FDTDdELEVBQUtzRCxRQUFBQSxPQUFMLElBQ0h0RCxFQUFBNkQscUJBSkw3RCxFQUFBc0QsZ0JBU0lRLEVBQUFBLG1CQUFBLFNBQUF4QixHQURBLEdBQUl3QixHQUFPLEdBQUlDLEtBR2YvRCxHQUFLdUQsRUFBUVMsV0FBYmhFLElBQUE4RCxFQUFBRyxhQUFBakUsSUFBQThELEVBQUFJLGFBSkpsRSxFQUFBdUQsUUFBQVMsT0FBQSxrRkFjZ0MxQixFQUFBRyxLQWRoQyx3REFlSUgsRUFBQTZCLEtBZkosa0VBZ0JzQ0YsRUFoQnRDLGlDQXlCSWpFLEVBQUt1RCxRQUFRLEdBQUdhLFVBQVlwRSxFQUFLdUQsUUFBUSxHQUFHYyxjQXhHeERyRSxFQUFBNkQsbUJBQUEsV0E4RlksR0FBSUMsR0FBTyxHQUFJQyxLQUNmRCxHQUFVQSxFQUFLUSxXQUFmLElBQTZCUixFQUFLRyxhQUFsQyxJQUFrREgsRUFBS0ksYUFFdkRsRSxFQUFLdUQsUUFBUVMsT0FBYixtRkFFNENoRSxFQUFLQyxTQUZqRCx3REFHa0NELEVBQUtpQyxRQUh2QyxrRUFJNEM2QixFQUo1QyxpQ0FPQTlELEVBQUt1RCxRQUFRLEdBQUdhLFVBQVlwRSxFQUFLdUQsUUFBUSxHQUFHYyxjQXRHcERuRixRQUFBQyxPQUFBLFlBR0tvRixVQUFVLFlBQWFDLEtBRDVCdEYsVUFBZSxXQUNWcUYsS0FFQUEsVUFBVSxpQkFBa0JFLEtBR2pDRixVQUFTRSxXQUFBQSxLQXVETEMsRUFBQTVFLFNBQUEsU0FBQTtjQ2pFUixXQVlJLFFBQVNZLEdBQWdCZ0IsRUFBT2lELEVBQUlDLEdBQ2hDLEdBQU01RSxHQUFPRyxJQU9iSCxHQUFLa0IsUUFBVSxXQU1YLFFBQVMyRCxHQUFRQyxHQUNicEQsR0FDSWxDLElBQU9vRixFQUFZRSxFQUFTQyxPQUFPQyxTQUFXLE1BRS9DakQsRUFBS2dELE9BQUNFLFVBQWEsaUJBQ2xCbEQsS0FBQSxTQUFBa0QsR0FFQSxHQUFJQyxHQUFKRCxFQUFBckYsS0FBQXVGLFFBQ0FELEVBQUEsT0FDSSxLQUFBLEdBQUlFLEtBQUFBLEdBQ0FGLEdBQWdERyxhQUFoREgsRUFBT0UsR0FBQUEsbUJBQW1CRSxHQUFBQSxNQUFuQixHQUFQLENBQ0FKLEVBQUFFLEVBQUFHLEdBQUFELG1CQUFBLEdBQUFELFNBQ0gsT0FYVEcsRUFBQUMsUUFBQVAsS0FrQkFNLFFBQUFBLEdBQVNFLEdBQ1pGLEVBQUFFLE9BQUFuRSxHQXpCRCxJQUFLb0UsVUFBVUMsWUFDWCxPQUFPLENBRVgsSUFBSUosR0FBV2IsRUFBR2tCLE9BSnRCLE9BS0lGLFdBQVVDLFlBQVlFLG1CQUFtQmpCLEVBQVNrQixHQUx0RFAsRUFBQVEsU0FsQko5RyxRQUFBQyxPQUFBLFlBR0s4RyxRQUFRLGtCQUFtQnZGLEdBTWhDQSxFQUFnQlosU0FBVyxRQUFTLEtBQU0iLCJmaWxlIjoiY2l0eXRhbGsubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdjaXR5VGFsaycsIFsndWkucm91dGVyJywgJ25nU3RvcmFnZSddKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLmNvbmZpZyhSb3V0ZXNDb25maWcpO1xuXG4gICAgUm91dGVzQ29uZmlnLiRpbmplY3QgPSBbJyRzdGF0ZVByb3ZpZGVyJywgJyR1cmxSb3V0ZXJQcm92aWRlciddO1xuICAgIGZ1bmN0aW9uIFJvdXRlc0NvbmZpZygkc3RhdGVQcm92aWRlLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyXG4gICAgICAgICAgICAub3RoZXJ3aXNlKCcvc3RhcnQnKTtcblxuICAgICAgICAkc3RhdGVQcm92aWRlXG4gICAgICAgICAgICAvLyBTdGFydCBzY3JlZW4sIHdoZXJlIHVzZXIgZW50ZXJzIGhpcyBuYW1lXG4gICAgICAgICAgICAuc3RhdGUoJ3N0YXJ0Jywge1xuICAgICAgICAgICAgICAgIHVybDogJy9zdGFydCcsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9zdGFydC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnc3RhcnRDb250cm9sbGVyIGFzIHN0YXJ0J1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy8gRmluZCBzY3JlZW4sIHdoZXJlIGxvY2F0aW9uIGlzIGRldGVybWluZWQgYW5kIHVzZXIgYWRkcyBsYWJlbCBmb3IgY2hhdFxuICAgICAgICAgICAgLnN0YXRlKCdmaW5kJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9maW5kJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2ZpbmQuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2ZpbmRDaGF0Q29udHJvbGxlciBhcyBmaW5kJ1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy8gQ2hhdCBzdGF0ZVxuICAgICAgICAgICAgLnN0YXRlKCdjaGF0Jywge1xuICAgICAgICAgICAgICAgIHVybDogJy9jaGF0JyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NoYXQuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ2NoYXRDb250cm9sbGVyIGFzIGNoYXQnLFxuICAgICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnY2l0eVRhbGsnKVxuICAgICAgICAuY29uc3RhbnQoJ2NpdHl0YWxrQXBpVXJsJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC8nKVxuICAgICAgICAvLyAuY29uc3RhbnQoJ2NpdHl0YWxrQXBpVXJsJywgJ2h0dHBzOi8vY2l0eXRhbGsuaGVyb2t1YXBwLmNvbS8nKVxuICAgICAgICAuY29uc3RhbnQoJ2dlb0FwaVVybCcsICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uP2xhdGxuZz0nKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3N0YXJ0Q29udHJvbGxlcicsIHN0YXJ0Q29udHJvbGxlcilcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2ZpbmRDaGF0Q29udHJvbGxlcicsIGZpbmRDaGF0Q29udHJvbGxlcilcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2NoYXRDb250cm9sbGVyJywgY2hhdENvbnRyb2xsZXIpO1xuXG5cbiAgICAvKipcbiAgICAgKiBTdGFydCBzY3JlZW4gY29udHJvbGxlclxuICAgICAqL1xuICAgIHN0YXJ0Q29udHJvbGxlci4kaW5qZWN0ID0gWyckc3RhdGUnLCAnJGxvY2FsU3RvcmFnZSddO1xuICAgIGZ1bmN0aW9uIHN0YXJ0Q29udHJvbGxlcigkc3RhdGUsICRsb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNlbGYudXNlck5hbWUgPSAkbG9jYWxTdG9yYWdlLnVzZXJOYW1lIHx8ICcnO1xuXG4gICAgICAgIHNlbGYuc2V0VmFsaWRVc2VyTmFtZSA9IChuYW1lKSA9PiB7XG4gICAgICAgICAgICBsZXQgdmFsaWROYW1lID0gbmFtZS5yZXBsYWNlKC8oPChbXj5dKyk+KS9pZywgXCJcIik7XG4gICAgICAgICAgICBzZWxmLnVzZXJOYW1lID0gdmFsaWROYW1lO1xuICAgICAgICAgICAgJGxvY2FsU3RvcmFnZS51c2VyTmFtZSA9IHZhbGlkTmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLnNldE5hbWVBbmRDaGFuZ2VTdGF0ZSA9IChuYW1lKSA9PiB7XG4gICAgICAgICAgICBzZWxmLnNldFZhbGlkVXNlck5hbWUobmFtZSk7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2ZpbmQnKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogRmluZCBzY3JlZW4gY29udHJvbGxlclxuICAgICAqL1xuICAgIGZpbmRDaGF0Q29udHJvbGxlci4kaW5qZWN0ID0gWyckc3RhdGUnLCAnJGh0dHAnLCAnbG9jYXRpb25TZXJ2aWNlJywgJ2NpdHl0YWxrQXBpVXJsJ107XG4gICAgZnVuY3Rpb24gZmluZENoYXRDb250cm9sbGVyKCRzdGF0ZSwgJGh0dHAsIGxvY2F0aW9uU2VydmljZSwgY2l0eXRhbGtBcGlVcmwpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNlbGYubG9jYXRpb25EZW5pZWQgPSBmYWxzZTtcbiAgICAgICAgc2VsZi51c2VyTmFtZSA9IGxvY2FsU3RvcmFnZS51c2VyTmFtZSB8fCAnJztcbiAgICAgICAgc2VsZi51c2VyTG9jYXRpb24gPSAnd29ybGQnO1xuICAgICAgICBzZWxmLnVzZXJQcmVmZXJyZWRMb2NhdGlvbiA9ICd3b3JsZCc7XG4gICAgICAgIHNlbGYudXNlckxhYmVsID0gJyc7XG5cbiAgICAgICAgLy9DaGVjayBpZiB1c2VybmFtZSBzZXQgYW5kIGxvY2F0ZSBjaXR5XG4gICAgICAgIHNlbGYuaW5pdCA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChzZWxmLnVzZXJOYW1lID09PSAnJykge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc3RhcnQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuc2V0Q2l0eSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuc2V0Q2l0eSA9ICgpID0+IHtcbiAgICAgICAgICAgIGxvY2F0aW9uU2VydmljZS5nZXRDaXR5KClcbiAgICAgICAgICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXNlckxvY2F0aW9uID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvY2F0aW9uRXJyb3IgPSAnJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9jYXRpb25FcnJvciA9ICdBbGxvdyB1c2luZyBsb2NhdGlvbiB0byBmaW5kIHlvdXIgY2l0eSc7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9jYXRpb25EZW5pZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuc3RhcnRDaGF0ID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YXJ0IGNoYXQnKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2VyTmFtZScsIHNlbGYudXNlck5hbWUpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2xvY2F0aW9uJywgc2VsZi51c2VyTG9jYXRpb24pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzZXJQcmVmZXJyZWRMb2NhdGlvbicsIHNlbGYudXNlclByZWZlcnJlZExvY2F0aW9uKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsYWJlbCcsIHNlbGYudXNlckxhYmVsKTtcblxuICAgICAgICAgICAgJGh0dHAucG9zdChjaXR5dGFsa0FwaVVybCArICdmaW5kY2hhdCcsIHtcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogc2VsZi51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICB1c2VyTG9jYXRpb246IChzZWxmLnVzZXJQcmVmZXJyZWRMb2NhdGlvbiA9PT0gJ3dvcmxkJykgP1xuICAgICAgICAgICAgICAgICAgICAnd29ybGQnIDogc2VsZi51c2VyTG9jYXRpb24sXG4gICAgICAgICAgICAgICAgdXNlckxhYmVsOiAoc2VsZi51c2VyTGFiZWwgPT09ICcnKSA/XG4gICAgICAgICAgICAgICAgICAgICdsYWJlbCcgOiBzZWxmLnVzZXJMYWJlbC50cmltKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlRGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZURhdGEuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnY2hhdCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29tOiByZXNwb25zZURhdGEuZGF0YS5yb29tLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2VEYXRhLmRhdGEuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBzZWxmLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJMb2NhdGlvbjogc2VsZi51c2VyTG9jYXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5pbml0KCk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBDaGF0IGNvbnRyb2xsZXJcbiAgICAgKi9cbiAgICBjaGF0Q29udHJvbGxlci4kaW5qZWN0ID0gWyckc3RhdGUnLCAnJHNjb3BlJywgJyRyb290U2NvcGUnXTtcbiAgICBmdW5jdGlvbiBjaGF0Q29udHJvbGxlcigkc3RhdGUsICRzY29wZSwgJHJvb3RTY29wZSkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICBpZiAoISRzdGF0ZS5wYXJhbXMuZGF0YSkge1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdmaW5kJyk7XG4gICAgICAgIH1cblxuICAgICAgICBzZWxmLnVzZXJOYW1lID0gJHN0YXRlLnBhcmFtcy5kYXRhLnVzZXJOYW1lO1xuICAgICAgICBzZWxmLnVzZXJMb2NhdGlvbiA9ICRzdGF0ZS5wYXJhbXMuZGF0YS51c2VyTG9jYXRpb247XG4gICAgICAgIHNlbGYucm9vbSA9ICRzdGF0ZS5wYXJhbXMuZGF0YS5yb29tO1xuICAgICAgICBzZWxmLm1lc3NhZ2UgPSAnJztcbiAgICAgICAgc2VsZi5jaGF0U3RhcnRlZCA9IGZhbHNlO1xuXG4gICAgICAgIHZhciBzb2NrZXQgPSBpbygpO1xuICAgICAgICAvLyBDb25uZWN0XG4gICAgICAgIHNvY2tldC5vbignY29ubmVjdCcsICgpID0+IHtcbiAgICAgICAgICAgIC8vIENvbm5lY3RlZCwgbGV0J3Mgc2lnbi11cCBmb3IgdG8gcmVjZWl2ZSBtZXNzYWdlcyBmb3IgdGhpcyByb29tXG4gICAgICAgICAgICBzb2NrZXQuZW1pdCgnam9pbiByb29tJywgJ3VzZXJSb29tXycgKyBzZWxmLnJvb20pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTdGFydCBjaGF0KGJvdGggcGFydG5lcnMgY29ubmVjdGVkKVxuICAgICAgICBzb2NrZXQub24oJ3N0YXJ0JywgKG1zZykgPT4ge1xuICAgICAgICAgICAgLy8gTm9uLWFuZ3VsYXIgZXZlbnQsIGNhbGwgJGFwcGx5XG4gICAgICAgICAgICAkc2NvcGUuJGFwcGx5KCgpID0+IHtcbiAgICAgICAgICAgICAgICBzZWxmLmNoYXRTdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTZW5kIG1lc3NhZ2VcbiAgICAgICAgc2VsZi5zZW5kTWVzc2FnZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZW5kbWVzYWdlJywgc2VsZi5tZXNzYWdlKTtcblxuICAgICAgICAgICAgdmFyIG1zZ0RhdGEgPSB7XG4gICAgICAgICAgICAgICAgdXNlcjogc2VsZi51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICB0ZXh0OiBzZWxmLm1lc3NhZ2VcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNvY2tldC5lbWl0KCdjaGF0IG1lc3NhZ2UnLCBtc2dEYXRhKTtcbiAgICAgICAgICAgIHNlbGYubWVzc2FnZSA9ICcnO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFJlY2VpdmUgbWVzc2FnZVxuICAgICAgICBzb2NrZXQub24oJ2NoYXQgbWVzc2FnZScsIChtc2cpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtZXNzYWdlOiAnICsgbXNnKTtcbiAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdjaXR5dGFsazppbmNvbWluZy1tc2cnLCBtc2cpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdjaXR5VGFsaycpXG4gICAgICAgIC5jb21wb25lbnQoJ3N0YXJ0Rm9ybScsIHN0YXJ0Rm9ybUNvbXBvbmVudCgpKVxuICAgICAgICAuY29tcG9uZW50KCdmaW5kRm9ybScsIGZpbmRGb3JtQ29tcG9uZW50KCkpXG4gICAgICAgIC5jb21wb25lbnQoJ2NpdHlUYWxrSGVhZGVyJywgY2l0eVRhbGtIZWFkZXJDb21wb25lbnQoKSlcbiAgICAgICAgLmNvbXBvbmVudCgnY2hhdEZvcm0nLCBjaGF0Rm9ybUNvbXBvbmVudCgpKTtcblxuICAgIGZ1bmN0aW9uIGNpdHlUYWxrSGVhZGVyQ29tcG9uZW50KCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jb21wb25lbnRzL2hlYWRlci5odG1sJyxcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICAgICAgdXNlck5hbWU6ICdAJyxcbiAgICAgICAgICAgICAgICB1c2VyTG9jYXRpb246ICdAJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3RhcnRGb3JtQ29tcG9uZW50KCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jb21wb25lbnRzL3N0YXJ0LWZvcm0uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBzdGFydEZvcm1Db21wb25lbnRDb250cm9sbGVyLFxuICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICBzZXROYW1lQW5kQ2hhbmdlU3RhdGU6ICcmJyxcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogJ0AnXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdGFydEZvcm1Db21wb25lbnRDb250cm9sbGVyKCkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi5pc05hbWVWYWxpZCA9IChuYW1lKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmFtZS50cmltKCkubGVuZ3RoO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGZpbmRGb3JtQ29tcG9uZW50KCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jb21wb25lbnRzL2ZpbmQtZm9ybS5odG1sJyxcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICAgICAgc3RhcnRDaGF0OiAnJicsXG4gICAgICAgICAgICAgICAgbG9jYXRpb25EZW5pZWQ6ICc8JyxcbiAgICAgICAgICAgICAgICBsYWJlbDogJz0nLFxuICAgICAgICAgICAgICAgIHByZWZlcnJlZExvY2F0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNoYXRGb3JtQ29tcG9uZW50KCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jb21wb25lbnRzL2NoYXQtZm9ybS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGNoYXRGb3JtQ29tcG9uZW50Q29udHJvbGxlcixcbiAgICAgICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJz0nLFxuICAgICAgICAgICAgICAgIGNoYXRTdGFydGVkOiAnPCcsXG4gICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2U6ICcmJyxcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogJ0AnXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjaGF0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRlbGVtZW50J107XG4gICAgZnVuY3Rpb24gY2hhdEZvcm1Db21wb25lbnRDb250cm9sbGVyKCRzY29wZSwgJGVsZW1lbnQpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNlbGYuY2hhdEJveCA9ICRlbGVtZW50LmZpbmQoJyNjaGF0LWJveCcpO1xuXG4gICAgICAgICRzY29wZS4kb24oJ2NpdHl0YWxrOmluY29taW5nLW1zZycsIChldmVudCwgZGF0YSkgPT4ge1xuICAgICAgICAgICAgc2VsZi5hZGRJbmNvbWluZ01lc3NhZ2UoZGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHNlbGYuc2VuZE91dE1lc3NhZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoc2VsZi5tZXNzYWdlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBzZWxmLmFkZE91dGdvaW5nTWVzc2FnZSgpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2VuZE1lc3NhZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmFkZEluY29taW5nTWVzc2FnZSA9IChtc2cpID0+IHtcbiAgICAgICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGRhdGUgPSBgJHtkYXRlLmdldEhvdXJzKCl9OiR7ZGF0ZS5nZXRNaW51dGVzKCl9OiR7ZGF0ZS5nZXRTZWNvbmRzKCl9YDtcblxuICAgICAgICAgICAgc2VsZi5jaGF0Qm94LmFwcGVuZChcbiAgICAgICAgICAgICAgICBgPHAgY2xhc3M9XCJtc2cgbXNnLS1pblwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1zZ19fdXNlciB0ZXh0LWluZm9cIj4ke21zZy51c2VyfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtc2dfX3RleHRcIj4ke21zZy50ZXh0fTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtc2dfX3RpbWUgdGV4dC1pbmZvXCI+JHtkYXRlfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L3A+YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHNlbGYuY2hhdEJveFswXS5zY3JvbGxUb3AgPSBzZWxmLmNoYXRCb3hbMF0uc2Nyb2xsSGVpZ2h0O1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuYWRkT3V0Z29pbmdNZXNzYWdlID0gKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgZGF0ZSA9IGAke2RhdGUuZ2V0SG91cnMoKX06JHtkYXRlLmdldE1pbnV0ZXMoKX06JHtkYXRlLmdldFNlY29uZHMoKX1gO1xuXG4gICAgICAgICAgICBzZWxmLmNoYXRCb3guYXBwZW5kKFxuICAgICAgICAgICAgICAgIGA8cCBjbGFzcz1cIm1zZyBtc2ctLW91dFwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1zZ19fdXNlciB0ZXh0LWluZm9cIj4ke3NlbGYudXNlck5hbWV9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cIm1zZ19fdGV4dFwiPiR7c2VsZi5tZXNzYWdlfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtc2dfX3RpbWUgdGV4dC1pbmZvXCI+JHtkYXRlfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L3A+YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHNlbGYuY2hhdEJveFswXS5zY3JvbGxUb3AgPSBzZWxmLmNoYXRCb3hbMF0uc2Nyb2xsSGVpZ2h0O1xuICAgICAgICB9O1xuICAgIH1cblxufSkoKTtcblxuIiwiKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdjaXR5VGFsaycpXG4gICAgICAgIC5zZXJ2aWNlKCdsb2NhdGlvblNlcnZpY2UnLCBsb2NhdGlvblNlcnZpY2UpO1xuXG5cbiAgICAvKipcbiAgICAgKiBMb2NhdGlvbiBzZXJ2aWNlXG4gICAgICovXG4gICAgbG9jYXRpb25TZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2dlb0FwaVVybCddO1xuICAgIGZ1bmN0aW9uIGxvY2F0aW9uU2VydmljZSgkaHR0cCwgJHEsIGdlb0FwaVVybCkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IGNsaWVudCBjaXR5IGJhc2VkIG9uIG5hdmlnYXRvci5nZW9sb2NhdGlvbiBhbmQgZ29vZ2xlIGdlb0FwaVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcmV0dXJucyBwcm9taXNlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldENpdHkgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIW5hdmlnYXRvci5nZW9sb2NhdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBkZWZmZXJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKHN1Y2Nlc3MsIGVycm9yKTtcbiAgICAgICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MocG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogKCBnZW9BcGlVcmwgKyBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUgKyAnJTJDJyArXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUgKyAnJmxhbmd1YWdlPWVuJyApXG4gICAgICAgICAgICAgICAgfSkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmluZCBjaXR5IG5hbWUgaW4gdW5vcmRlcmVkIHJlc3VsdHMgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3BvbnNlUmVzdWx0cyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNpdHkgPSAnd29ybGQnO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpIGluIHJlc3BvbnNlUmVzdWx0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlUmVzdWx0c1tpXS5hZGRyZXNzX2NvbXBvbmVudHNbMF0udHlwZXNbMF0gPT09ICdsb2NhbGl0eScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaXR5ID0gcmVzcG9uc2VSZXN1bHRzW2ldLmFkZHJlc3NfY29tcG9uZW50c1swXS5sb25nX25hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZGVmZmVyZWQucmVzb2x2ZShjaXR5KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3IoZXJyKSB7XG4gICAgICAgICAgICAgICAgZGVmZmVyZWQucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZmZXJlZC5wcm9taXNlO1xuICAgICAgICB9XG4gICAgfVxuXG5cbn0pKCk7Il19
