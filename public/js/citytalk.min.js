!function(){"use strict";angular.module("cityTalk",["ui.router"]).constant("geoApiUrl","https://maps.googleapis.com/maps/api/geocode/json?latlng=")}();
!function(){"use strict";function t(t,r){r.otherwise("/start"),t.state("start",{url:"/start",templateUrl:"views/start.html",controller:"startController as start"}).state("find",{url:"/find",templateUrl:"views/find.html",controller:"findChatController as find"}).state("chat",{url:"/chat",templateUrl:"views/chat.html",controller:"chatController as chat",params:{data:null}})}angular.module("cityTalk").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";function o(o){var e=this;e.userName=localStorage.userName||"",e.setUserName=function(e){localStorage.userName=e.replace(/(<([^>]+)>)/gi,""),o.go("find")}}function e(o,e,t){var a=this;a.locationDenied=!1,a.userName=localStorage.userName||"",a.userLocation="world",a.userPreferredLocation="world",a.userLabel="",a.init=function(){""===a.userName&&o.go("start"),a.setCity()},a.setCity=function(){t.getCity().then(function(o){a.userLocation=o,a.locationError=""}).catch(function(o){console.log(o),a.locationError="Allow using location to find your city",a.locationDenied=!0})},a.startChat=function(){console.log("start chat"),console.log("userName",a.userName),console.log("location",a.userLocation),console.log("userPreferredLocation",a.userPreferredLocation),console.log("label",a.userLabel);var t="http://localhost:3000";e.post(t+"/findchat",{userName:a.userName,userLocation:"world"===a.userPreferredLocation?"world":a.userLocation,userLabel:""===a.userLabel?"label":a.userLabel.trim()}).then(function(e){console.log(e.data),o.go("chat",{data:{room:e.data.room,status:e.data.status,userName:a.userName,userLocation:a.userLocation}})})},a.init()}function t(o,e,t){var a=this;o.params.data||o.go("find"),a.userName=o.params.data.userName,a.userLocation=o.params.data.userLocation,a.room=o.params.data.room,a.message="",a.chatStarted=!1;var r=io();r.on("connect",function(){r.emit("join room","userRoom_"+a.room)}),r.on("start",function(o){e.$apply(function(){a.chatStarted=!0})}),a.sendMessage=function(){console.log("sendmesage",a.message);var o={user:a.userName,text:a.message};r.emit("chat message",o),a.message=""},r.on("chat message",function(o){console.log("message: "+o),e.$broadcast("citytalk:incoming-msg",o)})}angular.module("cityTalk").controller("startController",o).controller("findChatController",e).controller("chatController",t),o.$inject=["$state"],e.$inject=["$state","$http","locationService"],t.$inject=["$state","$scope","$rootScope"]}();
!function(){"use strict";function s(){return{templateUrl:"views/components/header.html",bindings:{userName:"@",userLocation:"@"}}}function e(){return{templateUrl:"views/components/start-form.html",controller:t,bindings:{setUserName:"&",userName:"@"}}}function t(){var s=this;s.isNameValid=function(s){return s.trim().length}}function n(){return{templateUrl:"views/components/find-form.html",bindings:{startChat:"&",locationDenied:"<",label:"=",preferredLocation:"="}}}function a(){return{templateUrl:"views/components/chat-form.html",controller:o,bindings:{message:"=",chatStarted:"<",sendMessage:"&",userName:"@"}}}function o(s,e){var t=this;t.chatBox=e.find("#chat-box"),s.$on("citytalk:incoming-msg",function(s,e){t.addIncomingMessage(e)}),t.sendOutMessage=function(){t.message.length>0&&(t.addOutgoingMessage(),t.sendMessage())},t.addIncomingMessage=function(s){var e=new Date;e=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),t.chatBox.append('<p class="msg msg--in"><span class="msg__user text-info">'+s.user+'</span><span class="msg__text">'+s.text+'</span><span class="msg__time text-info">'+e+"</span></p>"),console.log("---------------------------------"),console.log('<p class="msg msg--in"><span class="msg__user text-info">'+s.user+'</span><span class="msg__text">'+s.text+'</span><span class="msg__time text-info">'+e+"</span></p>"),console.log("**************************************"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight},t.addOutgoingMessage=function(){var s=new Date;s=s.getHours()+":"+s.getMinutes()+":"+s.getSeconds(),t.chatBox.append('<p class="msg msg--out"><span class="msg__user text-info">'+t.userName+'</span><span class="msg__text">'+t.message+'</span><span class="msg__time text-info">'+s+"</span></p>"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight}}angular.module("cityTalk").component("startForm",e()).component("findForm",n()).component("cityTalkHeader",s()).component("chatForm",a()),o.$inject=["$scope","$element"]}();
!function(){"use strict";function t(t,e,o){var n=this;n.getCity=function(){function n(e){t({url:o+e.coords.latitude+"%2C"+e.coords.longitude+"&language=en"}).then(function(t){var e=t.data.results,o="world";for(var n in e)if("locality"===e[n].address_components[0].types[0]){o=e[n].address_components[0].long_name;break}i.resolve(o)})}function r(t){i.reject(t)}if(!navigator.geolocation)return!1;var i=e.defer();return navigator.geolocation.getCurrentPosition(n,r),i.promise}}angular.module("cityTalk").service("locationService",t),t.$inject=["$http","$q","geoApiUrl"]}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNpdHl0YWxrLm1vZHVsZS5qcyIsImNpdHl0YWxrLnJvdXRlcy5qcyIsImNvbnRyb2xsZXJzL2NpdHl0YWxrLmNvbnRyb2xsZXJzLmpzIiwiY29tcG9uZW50cy9jaXR5dGFsay5jb21wb25lbnRzLmpzIiwic2VydmljZXMvY2l0eXRhbGsuc2VydmljZXMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiUm91dGVzQ29uZmlnIiwiJHN0YXRlUHJvdmlkZSIsIiR1cmxSb3V0ZXJQcm92aWRlciIsIm90aGVyd2lzZSIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicGFyYW1zIiwiZGF0YSIsImNvbmZpZyIsIiRpbmplY3QiLCJzdGFydENvbnRyb2xsZXIiLCIkc3RhdGUiLCJzZWxmIiwidGhpcyIsInVzZXJOYW1lIiwibG9jYWxTdG9yYWdlIiwic2V0VXNlck5hbWUiLCJuYW1lIiwicmVwbGFjZSIsImdvIiwiZmluZENoYXRDb250cm9sbGVyIiwiJGh0dHAiLCJsb2NhdGlvblNlcnZpY2UiLCJsb2NhdGlvbkRlbmllZCIsInVzZXJMb2NhdGlvbiIsInVzZXJQcmVmZXJyZWRMb2NhdGlvbiIsInVzZXJMYWJlbCIsImluaXQiLCJzZXRDaXR5IiwiZ2V0Q2l0eSIsInRoZW4iLCJyZXN1bHQiLCJsb2NhdGlvbkVycm9yIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwic3RhcnRDaGF0IiwiYXBpVXJsIiwicG9zdCIsInRyaW0iLCJyZXNwb25zZURhdGEiLCJyb29tIiwic3RhdHVzIiwiY2hhdENvbnRyb2xsZXIiLCIkc2NvcGUiLCIkcm9vdFNjb3BlIiwibWVzc2FnZSIsImNoYXRTdGFydGVkIiwic29ja2V0IiwiaW8iLCJvbiIsImVtaXQiLCJtc2ciLCIkYXBwbHkiLCJzZW5kTWVzc2FnZSIsIm1zZ0RhdGEiLCJ1c2VyIiwidGV4dCIsIiRicm9hZGNhc3QiLCJjaXR5VGFsa0hlYWRlckNvbXBvbmVudCIsImJpbmRpbmdzIiwic3RhcnRGb3JtQ29tcG9uZW50Iiwic3RhcnRGb3JtQ29tcG9uZW50Q29udHJvbGxlciIsImlzTmFtZVZhbGlkIiwibGVuZ3RoIiwiZmluZEZvcm1Db21wb25lbnQiLCJsYWJlbCIsInByZWZlcnJlZExvY2F0aW9uIiwiY2hhdEZvcm1Db21wb25lbnQiLCJjaGF0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIiLCIkZWxlbWVudCIsImNoYXRCb3giLCJmaW5kIiwiJG9uIiwiZXZlbnQiLCJhZGRJbmNvbWluZ01lc3NhZ2UiLCJzZW5kT3V0TWVzc2FnZSIsImFkZE91dGdvaW5nTWVzc2FnZSIsImRhdGUiLCJEYXRlIiwiZ2V0SG91cnMiLCJnZXRNaW51dGVzIiwiZ2V0U2Vjb25kcyIsImFwcGVuZCIsInNjcm9sbFRvcCIsInNjcm9sbEhlaWdodCIsImNvbXBvbmVudCIsIiRxIiwiZ2VvQXBpVXJsIiwic3VjY2VzcyIsInBvc2l0aW9uIiwiY29vcmRzIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJyZXNwb25zZSIsInJlc3BvbnNlUmVzdWx0cyIsInJlc3VsdHMiLCJjaXR5IiwiaSIsImFkZHJlc3NfY29tcG9uZW50cyIsInR5cGVzIiwibG9uZ19uYW1lIiwiZGVmZmVyZWQiLCJyZXNvbHZlIiwiZXJyb3IiLCJyZWplY3QiLCJuYXZpZ2F0b3IiLCJnZW9sb2NhdGlvbiIsImRlZmVyIiwiZ2V0Q3VycmVudFBvc2l0aW9uIiwicHJvbWlzZSIsInNlcnZpY2UiXSwibWFwcGluZ3MiOiJDQUFBLFdBRUksWUFFQUEsU0FBUUMsT0FBTyxZQUFhLGNBQ3ZCQyxTQUFTLFlBQWE7Q0NML0IsV0FFSSxZQU1BLFNBQVNDLEdBQWFDLEVBQWVDLEdBQ2pDQSxFQUNLQyxVQUFVLFVBRWZGLEVBRUtHLE1BQU0sU0FDSEMsSUFBSyxTQUNMQyxZQUFhLG1CQUNiQyxXQUFZLDZCQUlmSCxNQUFNLFFBQ0hDLElBQUssUUFDTEMsWUFBYSxrQkFDYkMsV0FBWSwrQkFJZkgsTUFBTSxRQUNIQyxJQUFLLFFB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U08sR0FBTXZFLEdBQ1hxRSxFQUFTRyxPQUFPeEUsR0F4QnBCLElBQUt5RSxVQUFVQyxZQUNYLE9BQU8sQ0FFWCxJQUFJTCxHQUFXZixFQUFHcUIsT0F3QmxCLE9BdkJBRixXQUFVQyxZQUFZRSxtQkFBbUJwQixFQUFTZSxHQXVCM0NGLEVBQVNRLFNBNUN4QnBILFFBQVFDLE9BQU8sWUFDVm9ILFFBQVEsa0JBQW1CMUYsR0FNaENBLEVBQWdCYixTQUFXLFFBQVMsS0FBTSIsImZpbGUiOiJjaXR5dGFsay5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJywgWyd1aS5yb3V0ZXInXSlcbiAgICAgICAgLmNvbnN0YW50KCdnZW9BcGlVcmwnLCAnaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbj9sYXRsbmc9Jyk7XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdjaXR5VGFsaycpXG4gICAgICAgIC5jb25maWcoUm91dGVzQ29uZmlnKTtcblxuICAgIFJvdXRlc0NvbmZpZy4kaW5qZWN0ID0gWyckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInXTtcbiAgICBmdW5jdGlvbiBSb3V0ZXNDb25maWcoJHN0YXRlUHJvdmlkZSwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlclxuICAgICAgICAgICAgLm90aGVyd2lzZSgnL3N0YXJ0Jyk7XG5cbiAgICAgICAgJHN0YXRlUHJvdmlkZVxuICAgICAgICAgICAgLy8gU3RhcnQgc2NyZWVuLCB3aGVyZSB1c2VyIGVudGVycyBoaXMgbmFtZVxuICAgICAgICAgICAgLnN0YXRlKCdzdGFydCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvc3RhcnQnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3Mvc3RhcnQuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3N0YXJ0Q29udHJvbGxlciBhcyBzdGFydCdcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIEZpbmQgc2NyZWVuLCB3aGVyZSBsb2NhdGlvbiBpcyBkZXRlcm1pbmVkIGFuZCB1c2VyIGFkZHMgbGFiZWwgZm9yIGNoYXRcbiAgICAgICAgICAgIC5zdGF0ZSgnZmluZCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvZmluZCcsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9maW5kLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdmaW5kQ2hhdENvbnRyb2xsZXIgYXMgZmluZCdcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIENoYXQgc3RhdGVcbiAgICAgICAgICAgIC5zdGF0ZSgnY2hhdCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvY2hhdCcsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jaGF0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjaGF0Q29udHJvbGxlciBhcyBjaGF0JyxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ3N0YXJ0Q29udHJvbGxlcicsIHN0YXJ0Q29udHJvbGxlcilcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2ZpbmRDaGF0Q29udHJvbGxlcicsIGZpbmRDaGF0Q29udHJvbGxlcilcbiAgICAgICAgLmNvbnRyb2xsZXIoJ2NoYXRDb250cm9sbGVyJywgY2hhdENvbnRyb2xsZXIpO1xuXG5cbiAgICAvKipcbiAgICAgKiBTdGFydCBzY3JlZW4gY29udHJvbGxlclxuICAgICAqL1xuICAgIHN0YXJ0Q29udHJvbGxlci4kaW5qZWN0ID0gWyckc3RhdGUnXTtcbiAgICBmdW5jdGlvbiBzdGFydENvbnRyb2xsZXIoJHN0YXRlKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi51c2VyTmFtZSA9IGxvY2FsU3RvcmFnZS51c2VyTmFtZSB8fCAnJztcblxuICAgICAgICBzZWxmLnNldFVzZXJOYW1lID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS51c2VyTmFtZSA9IG5hbWUucmVwbGFjZSgvKDwoW14+XSspPikvaWcsXCJcIik7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2ZpbmQnKTtcbiAgICAgICAgfTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEZpbmQgc2NyZWVuIGNvbnRyb2xsZXJcbiAgICAgKi9cbiAgICBmaW5kQ2hhdENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHN0YXRlJywgJyRodHRwJywgJ2xvY2F0aW9uU2VydmljZSddO1xuICAgIGZ1bmN0aW9uIGZpbmRDaGF0Q29udHJvbGxlcigkc3RhdGUsICRodHRwLCBsb2NhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBzZWxmLmxvY2F0aW9uRGVuaWVkID0gZmFsc2U7XG4gICAgICAgIHNlbGYudXNlck5hbWUgPSBsb2NhbFN0b3JhZ2UudXNlck5hbWUgfHwgJyc7XG4gICAgICAgIHNlbGYudXNlckxvY2F0aW9uID0gJ3dvcmxkJztcbiAgICAgICAgc2VsZi51c2VyUHJlZmVycmVkTG9jYXRpb24gPSAnd29ybGQnO1xuICAgICAgICBzZWxmLnVzZXJMYWJlbCA9ICcnO1xuXG4gICAgICAgIC8vQ2hlY2sgaWYgdXNlcm5hbWUgc2V0IGFuZCBsb2NhdGUgY2l0eVxuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoc2VsZi51c2VyTmFtZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3N0YXJ0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLnNldENpdHkoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLnNldENpdHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsb2NhdGlvblNlcnZpY2UuZ2V0Q2l0eSgpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnVzZXJMb2NhdGlvbiA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2NhdGlvbkVycm9yID0gJyc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvY2F0aW9uRXJyb3IgPSAnQWxsb3cgdXNpbmcgbG9jYXRpb24gdG8gZmluZCB5b3VyIGNpdHknO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvY2F0aW9uRGVuaWVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLnN0YXJ0Q2hhdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdGFydCBjaGF0Jyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygndXNlck5hbWUnLCBzZWxmLnVzZXJOYW1lKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2NhdGlvbicsIHNlbGYudXNlckxvY2F0aW9uKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2VyUHJlZmVycmVkTG9jYXRpb24nLCBzZWxmLnVzZXJQcmVmZXJyZWRMb2NhdGlvbik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbGFiZWwnLCBzZWxmLnVzZXJMYWJlbCk7XG5cbiAgICAgICAgICAgIHZhciBhcGlVcmwgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcbiAgICAgICAgICAgICRodHRwLnBvc3QoYXBpVXJsICsgJy9maW5kY2hhdCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6IHNlbGYudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHVzZXJMb2NhdGlvbjogKHNlbGYudXNlclByZWZlcnJlZExvY2F0aW9uPT09J3dvcmxkJykgP1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3dvcmxkJyA6IHNlbGYudXNlckxvY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgICB1c2VyTGFiZWw6IChzZWxmLnVzZXJMYWJlbD09PScnKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWwnIDogc2VsZi51c2VyTGFiZWwudHJpbSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZURhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2VEYXRhLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2NoYXQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vbTogcmVzcG9uc2VEYXRhLmRhdGEucm9vbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlRGF0YS5kYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogc2VsZi51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTG9jYXRpb246IHNlbGYudXNlckxvY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuaW5pdCgpO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogQ2hhdCBjb250cm9sbGVyXG4gICAgICovXG4gICAgY2hhdENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHN0YXRlJywgJyRzY29wZScsICckcm9vdFNjb3BlJ107XG4gICAgZnVuY3Rpb24gY2hhdENvbnRyb2xsZXIoJHN0YXRlLCAkc2NvcGUsICRyb290U2NvcGUpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIGlmICghJHN0YXRlLnBhcmFtcy5kYXRhKSB7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2ZpbmQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGYudXNlck5hbWUgPSAkc3RhdGUucGFyYW1zLmRhdGEudXNlck5hbWU7XG4gICAgICAgIHNlbGYudXNlckxvY2F0aW9uID0gJHN0YXRlLnBhcmFtcy5kYXRhLnVzZXJMb2NhdGlvbjtcbiAgICAgICAgc2VsZi5yb29tID0gJHN0YXRlLnBhcmFtcy5kYXRhLnJvb207XG4gICAgICAgIHNlbGYubWVzc2FnZSA9ICcnO1xuICAgICAgICBzZWxmLmNoYXRTdGFydGVkID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIHNvY2tldCA9IGlvKCk7XG4gICAgICAgIC8vIENvbm5lY3RcbiAgICAgICAgc29ja2V0Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gQ29ubmVjdGVkLCBsZXQncyBzaWduLXVwIGZvciB0byByZWNlaXZlIG1lc3NhZ2VzIGZvciB0aGlzIHJvb21cbiAgICAgICAgICAgIHNvY2tldC5lbWl0KCdqb2luIHJvb20nLCAndXNlclJvb21fJyArIHNlbGYucm9vbSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFN0YXJ0IGNoYXQoYm90aCBwYXJ0bmVycyBjb25uZWN0ZWQpXG4gICAgICAgIHNvY2tldC5vbignc3RhcnQnLCBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgICAgICAvLyBOb24tYW5ndWxhciBldmVudCwgY2FsbCAkYXBwbHlcbiAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYuY2hhdFN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNlbmQgbWVzc2FnZVxuICAgICAgICBzZWxmLnNlbmRNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlbmRtZXNhZ2UnLCBzZWxmLm1lc3NhZ2UpO1xuXG4gICAgICAgICAgICB2YXIgbXNnRGF0YSA9IHtcbiAgICAgICAgICAgICAgICB1c2VyOiBzZWxmLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgIHRleHQ6IHNlbGYubWVzc2FnZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2NoYXQgbWVzc2FnZScsIG1zZ0RhdGEpO1xuICAgICAgICAgICAgc2VsZi5tZXNzYWdlID0gJyc7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gUmVjZWl2ZSBtZXNzYWdlXG4gICAgICAgIHNvY2tldC5vbignY2hhdCBtZXNzYWdlJywgZnVuY3Rpb24gKG1zZykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ21lc3NhZ2U6ICcgKyBtc2cpO1xuICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NpdHl0YWxrOmluY29taW5nLW1zZycsIG1zZyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLmNvbXBvbmVudCgnc3RhcnRGb3JtJywgc3RhcnRGb3JtQ29tcG9uZW50KCkpXG4gICAgICAgIC5jb21wb25lbnQoJ2ZpbmRGb3JtJywgZmluZEZvcm1Db21wb25lbnQoKSlcbiAgICAgICAgLmNvbXBvbmVudCgnY2l0eVRhbGtIZWFkZXInLCBjaXR5VGFsa0hlYWRlckNvbXBvbmVudCgpKVxuICAgICAgICAuY29tcG9uZW50KCdjaGF0Rm9ybScsIGNoYXRGb3JtQ29tcG9uZW50KCkpO1xuXG4gICAgZnVuY3Rpb24gY2l0eVRhbGtIZWFkZXJDb21wb25lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NvbXBvbmVudHMvaGVhZGVyLmh0bWwnLFxuICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogJ0AnLFxuICAgICAgICAgICAgICAgIHVzZXJMb2NhdGlvbjogJ0AnXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdGFydEZvcm1Db21wb25lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NvbXBvbmVudHMvc3RhcnQtZm9ybS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IHN0YXJ0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIsXG4gICAgICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgICAgIHNldFVzZXJOYW1lOiAnJicsXG4gICAgICAgICAgICAgICAgdXNlck5hbWU6ICdAJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3RhcnRGb3JtQ29tcG9uZW50Q29udHJvbGxlcigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBzZWxmLmlzTmFtZVZhbGlkID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBuYW1lLnRyaW0oKS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmaW5kRm9ybUNvbXBvbmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvY29tcG9uZW50cy9maW5kLWZvcm0uaHRtbCcsXG4gICAgICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgICAgIHN0YXJ0Q2hhdDogJyYnLFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uRGVuaWVkOiAnPCcsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICc9JyxcbiAgICAgICAgICAgICAgICBwcmVmZXJyZWRMb2NhdGlvbjogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGF0Rm9ybUNvbXBvbmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvY29tcG9uZW50cy9jaGF0LWZvcm0uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBjaGF0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIsXG4gICAgICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICc9JyxcbiAgICAgICAgICAgICAgICBjaGF0U3RhcnRlZDogJzwnLFxuICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlOiAnJicsXG4gICAgICAgICAgICAgICAgdXNlck5hbWU6ICdAJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2hhdEZvcm1Db21wb25lbnRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckZWxlbWVudCddO1xuICAgIGZ1bmN0aW9uIGNoYXRGb3JtQ29tcG9uZW50Q29udHJvbGxlcigkc2NvcGUsICRlbGVtZW50KSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi5jaGF0Qm94ID0gJGVsZW1lbnQuZmluZCgnI2NoYXQtYm94Jyk7XG5cbiAgICAgICAgJHNjb3BlLiRvbignY2l0eXRhbGs6aW5jb21pbmctbXNnJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICBzZWxmLmFkZEluY29taW5nTWVzc2FnZShkYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2VsZi5zZW5kT3V0TWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLm1lc3NhZ2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNlbGYuYWRkT3V0Z29pbmdNZXNzYWdlKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZW5kTWVzc2FnZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuYWRkSW5jb21pbmdNZXNzYWdlID0gZnVuY3Rpb24gKG1zZykge1xuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgZGF0ZSA9IGRhdGUuZ2V0SG91cnMoKSArICc6JyArIGRhdGUuZ2V0TWludXRlcygpICsgJzonICsgZGF0ZS5nZXRTZWNvbmRzKCk7XG5cbiAgICAgICAgICAgIHNlbGYuY2hhdEJveC5hcHBlbmQoXG4gICAgICAgICAgICAgICAgJzxwIGNsYXNzPVwibXNnIG1zZy0taW5cIj4nICtcbiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJtc2dfX3VzZXIgdGV4dC1pbmZvXCI+JyArIG1zZy51c2VyICsgJzwvc3Bhbj4nICtcbiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJtc2dfX3RleHRcIj4nICsgbXNnLnRleHQgKyAnPC9zcGFuPicgK1xuICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cIm1zZ19fdGltZSB0ZXh0LWluZm9cIj4nICsgZGF0ZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgJzwvcD4nXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgICAgJzxwIGNsYXNzPVwibXNnIG1zZy0taW5cIj4nICtcbiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJtc2dfX3VzZXIgdGV4dC1pbmZvXCI+JyArIG1zZy51c2VyICsgJzwvc3Bhbj4nICtcbiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJtc2dfX3RleHRcIj4nICsgbXNnLnRleHQgKyAnPC9zcGFuPicgK1xuICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cIm1zZ19fdGltZSB0ZXh0LWluZm9cIj4nICsgZGF0ZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgJzwvcD4nXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqJyk7XG4gICAgICAgICAgICBzZWxmLmNoYXRCb3hbMF0uc2Nyb2xsVG9wID0gc2VsZi5jaGF0Qm94WzBdLnNjcm9sbEhlaWdodDtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmFkZE91dGdvaW5nTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGRhdGUgPSBkYXRlLmdldEhvdXJzKCkgKyAnOicgKyBkYXRlLmdldE1pbnV0ZXMoKSArICc6JyArIGRhdGUuZ2V0U2Vjb25kcygpO1xuXG4gICAgICAgICAgICBzZWxmLmNoYXRCb3guYXBwZW5kKFxuICAgICAgICAgICAgICAgICc8cCBjbGFzcz1cIm1zZyBtc2ctLW91dFwiPicgK1xuICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cIm1zZ19fdXNlciB0ZXh0LWluZm9cIj4nICsgc2VsZi51c2VyTmFtZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwibXNnX190ZXh0XCI+JyArIHNlbGYubWVzc2FnZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwibXNnX190aW1lIHRleHQtaW5mb1wiPicgKyBkYXRlICsgJzwvc3Bhbj4nICtcbiAgICAgICAgICAgICAgICAnPC9wPidcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzZWxmLmNoYXRCb3hbMF0uc2Nyb2xsVG9wID0gc2VsZi5jaGF0Qm94WzBdLnNjcm9sbEhlaWdodDtcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7XG5cbiIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnY2l0eVRhbGsnKVxuICAgICAgICAuc2VydmljZSgnbG9jYXRpb25TZXJ2aWNlJywgbG9jYXRpb25TZXJ2aWNlKTtcblxuXG4gICAgLyoqXG4gICAgICogTG9jYXRpb24gc2VydmljZVxuICAgICAqL1xuICAgIGxvY2F0aW9uU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdnZW9BcGlVcmwnXTtcbiAgICBmdW5jdGlvbiBsb2NhdGlvblNlcnZpY2UoJGh0dHAsICRxLCBnZW9BcGlVcmwpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgY2xpZW50IGNpdHkgYmFzZWQgb24gbmF2aWdhdG9yLmdlb2xvY2F0aW9uIGFuZCBnb29nbGUgZ2VvQXBpXG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm5zIHByb21pc2VcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0Q2l0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghbmF2aWdhdG9yLmdlb2xvY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGRlZmZlcmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oc3VjY2VzcywgZXJyb3IpO1xuICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2Vzcyhwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAoIGdlb0FwaVVybCArIHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSArICclMkMnICtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZSArICcmbGFuZ3VhZ2U9ZW4nIClcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBGaW5kIGNpdHkgbmFtZSBpbiB1bm9yZGVyZWQgcmVzdWx0cyBhcnJheVxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VSZXN1bHRzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2l0eSA9ICd3b3JsZCc7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2VSZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VSZXN1bHRzW2ldLmFkZHJlc3NfY29tcG9uZW50c1swXS50eXBlc1swXSA9PT0gJ2xvY2FsaXR5Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpdHkgPSByZXNwb25zZVJlc3VsdHNbaV0uYWRkcmVzc19jb21wb25lbnRzWzBdLmxvbmdfbmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZXNvbHZlKGNpdHkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvcihlcnIpIHtcbiAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRlZmZlcmVkLnByb21pc2U7XG4gICAgICAgIH1cbiAgICB9XG5cblxufSkoKTsiXX0=
