!function(){"use strict";angular.module("cityTalk",["ui.router"])}();
!function(){"use strict";function t(t,r){r.otherwise("/start"),t.state("start",{url:"/start",templateUrl:"views/start.html",controller:"startController as start"}).state("find",{url:"/find",templateUrl:"views/find.html",controller:"findChatController as find"}).state("chat",{url:"/chat",templateUrl:"views/chat.html",controller:"chatController as chat",params:{data:null}})}angular.module("cityTalk").config(t),t.$inject=["$stateProvider","$urlRouterProvider"]}();
!function(){"use strict";angular.module("cityTalk").constant("citytalkApiUrl","https://citytalk.herokuapp.com/").constant("geoApiUrl","https://maps.googleapis.com/maps/api/geocode/json?latlng=")}();
!function(){"use strict";function o(o){var e=this;e.userName=localStorage.userName||"",e.setUserName=function(e){localStorage.userName=e.replace(/(<([^>]+)>)/gi,""),o.go("find")}}function e(o,e,t,a){var r=this;r.locationDenied=!1,r.userName=localStorage.userName||"",r.userLocation="world",r.userPreferredLocation="world",r.userLabel="",r.init=function(){""===r.userName&&o.go("start"),r.setCity()},r.setCity=function(){t.getCity().then(function(o){r.userLocation=o,r.locationError=""}).catch(function(o){console.log(o),r.locationError="Allow using location to find your city",r.locationDenied=!0})},r.startChat=function(){console.log("start chat"),console.log("userName",r.userName),console.log("location",r.userLocation),console.log("userPreferredLocation",r.userPreferredLocation),console.log("label",r.userLabel),e.post(a+"findchat",{userName:r.userName,userLocation:"world"===r.userPreferredLocation?"world":r.userLocation,userLabel:""===r.userLabel?"label":r.userLabel.trim()}).then(function(e){console.log(e.data),o.go("chat",{data:{room:e.data.room,status:e.data.status,userName:r.userName,userLocation:r.userLocation}})})},r.init()}function t(o,e,t){var a=this;o.params.data||o.go("find"),a.userName=o.params.data.userName,a.userLocation=o.params.data.userLocation,a.room=o.params.data.room,a.message="",a.chatStarted=!1;var r=io();r.on("connect",function(){r.emit("join room","userRoom_"+a.room)}),r.on("start",function(o){e.$apply(function(){a.chatStarted=!0})}),a.sendMessage=function(){console.log("sendmesage",a.message);var o={user:a.userName,text:a.message};r.emit("chat message",o),a.message=""},r.on("chat message",function(o){console.log("message: "+o),e.$broadcast("citytalk:incoming-msg",o)})}angular.module("cityTalk").controller("startController",o).controller("findChatController",e).controller("chatController",t),o.$inject=["$state"],e.$inject=["$state","$http","locationService","citytalkApiUrl"],t.$inject=["$state","$scope","$rootScope"]}();
!function(){"use strict";function s(){return{templateUrl:"views/components/header.html",bindings:{userName:"@",userLocation:"@"}}}function e(){return{templateUrl:"views/components/start-form.html",controller:t,bindings:{setUserName:"&",userName:"@"}}}function t(){var s=this;s.isNameValid=function(s){return s.trim().length}}function n(){return{templateUrl:"views/components/find-form.html",bindings:{startChat:"&",locationDenied:"<",label:"=",preferredLocation:"="}}}function a(){return{templateUrl:"views/components/chat-form.html",controller:o,bindings:{message:"=",chatStarted:"<",sendMessage:"&",userName:"@"}}}function o(s,e){var t=this;t.chatBox=e.find("#chat-box"),s.$on("citytalk:incoming-msg",function(s,e){t.addIncomingMessage(e)}),t.sendOutMessage=function(){t.message.length>0&&(t.addOutgoingMessage(),t.sendMessage())},t.addIncomingMessage=function(s){var e=new Date;e=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),t.chatBox.append('<p class="msg msg--in"><span class="msg__user text-info">'+s.user+'</span><span class="msg__text">'+s.text+'</span><span class="msg__time text-info">'+e+"</span></p>"),console.log("---------------------------------"),console.log('<p class="msg msg--in"><span class="msg__user text-info">'+s.user+'</span><span class="msg__text">'+s.text+'</span><span class="msg__time text-info">'+e+"</span></p>"),console.log("**************************************"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight},t.addOutgoingMessage=function(){var s=new Date;s=s.getHours()+":"+s.getMinutes()+":"+s.getSeconds(),t.chatBox.append('<p class="msg msg--out"><span class="msg__user text-info">'+t.userName+'</span><span class="msg__text">'+t.message+'</span><span class="msg__time text-info">'+s+"</span></p>"),t.chatBox[0].scrollTop=t.chatBox[0].scrollHeight}}angular.module("cityTalk").component("startForm",e()).component("findForm",n()).component("cityTalkHeader",s()).component("chatForm",a()),o.$inject=["$scope","$element"]}();
!function(){"use strict";function t(t,e,o){var n=this;n.getCity=function(){function n(e){t({url:o+e.coords.latitude+"%2C"+e.coords.longitude+"&language=en"}).then(function(t){var e=t.data.results,o="world";for(var n in e)if("locality"===e[n].address_components[0].types[0]){o=e[n].address_components[0].long_name;break}i.resolve(o)})}function r(t){i.reject(t)}if(!navigator.geolocation)return!1;var i=e.defer();return navigator.geolocation.getCurrentPosition(n,r),i.promise}}angular.module("cityTalk").service("locationService",t),t.$inject=["$http","$q","geoApiUrl"]}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNpdHl0YWxrLm1vZHVsZS5qcyIsImNpdHl0YWxrLnJvdXRlcy5qcyIsImNsaWVudC5jb25mLmpzIiwiY29udHJvbGxlcnMvY2l0eXRhbGsuY29udHJvbGxlcnMuanMiLCJjb21wb25lbnRzL2NpdHl0YWxrLmNvbXBvbmVudHMuanMiLCJzZXJ2aWNlcy9jaXR5dGFsay5zZXJ2aWNlcy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiUm91dGVzQ29uZmlnIiwiJHN0YXRlUHJvdmlkZSIsIiR1cmxSb3V0ZXJQcm92aWRlciIsIm90aGVyd2lzZSIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicGFyYW1zIiwiZGF0YSIsImNvbmZpZyIsIiRpbmplY3QiLCJjb25zdGFudCIsInN0YXJ0Q29udHJvbGxlciIsIiRzdGF0ZSIsInNlbGYiLCJ0aGlzIiwidXNlck5hbWUiLCJsb2NhbFN0b3JhZ2UiLCJzZXRVc2VyTmFtZSIsIm5hbWUiLCJyZXBsYWNlIiwiZ28iLCJmaW5kQ2hhdENvbnRyb2xsZXIiLCIkaHR0cCIsImxvY2F0aW9uU2VydmljZSIsImNpdHl0YWxrQXBpVXJsIiwibG9jYXRpb25EZW5pZWQiLCJ1c2VyTG9jYXRpb24iLCJ1c2VyUHJlZmVycmVkTG9jYXRpb24iLCJ1c2VyTGFiZWwiLCJpbml0Iiwic2V0Q2l0eSIsImdldENpdHkiLCJ0aGVuIiwicmVzdWx0IiwibG9jYXRpb25FcnJvciIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsInN0YXJ0Q2hhdCIsInBvc3QiLCJ0cmltIiwicmVzcG9uc2VEYXRhIiwicm9vbSIsInN0YXR1cyIsImNoYXRDb250cm9sbGVyIiwiJHNjb3BlIiwiJHJvb3RTY29wZSIsIm1lc3NhZ2UiLCJjaGF0U3RhcnRlZCIsInNvY2tldCIsImlvIiwib24iLCJlbWl0IiwibXNnIiwiJGFwcGx5Iiwic2VuZE1lc3NhZ2UiLCJtc2dEYXRhIiwidXNlciIsInRleHQiLCIkYnJvYWRjYXN0IiwiY2l0eVRhbGtIZWFkZXJDb21wb25lbnQiLCJiaW5kaW5ncyIsInN0YXJ0Rm9ybUNvbXBvbmVudCIsInN0YXJ0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIiLCJpc05hbWVWYWxpZCIsImxlbmd0aCIsImZpbmRGb3JtQ29tcG9uZW50IiwibGFiZWwiLCJwcmVmZXJyZWRMb2NhdGlvbiIsImNoYXRGb3JtQ29tcG9uZW50IiwiY2hhdEZvcm1Db21wb25lbnRDb250cm9sbGVyIiwiJGVsZW1lbnQiLCJjaGF0Qm94IiwiZmluZCIsIiRvbiIsImV2ZW50IiwiYWRkSW5jb21pbmdNZXNzYWdlIiwic2VuZE91dE1lc3NhZ2UiLCJhZGRPdXRnb2luZ01lc3NhZ2UiLCJkYXRlIiwiRGF0ZSIsImdldEhvdXJzIiwiZ2V0TWludXRlcyIsImdldFNlY29uZHMiLCJhcHBlbmQiLCJzY3JvbGxUb3AiLCJzY3JvbGxIZWlnaHQiLCJjb21wb25lbnQiLCIkcSIsImdlb0FwaVVybCIsInN1Y2Nlc3MiLCJwb3NpdGlvbiIsImNvb3JkcyIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwicmVzcG9uc2UiLCJyZXNwb25zZVJlc3VsdHMiLCJyZXN1bHRzIiwiY2l0eSIsImkiLCJhZGRyZXNzX2NvbXBvbmVudHMiLCJ0eXBlcyIsImxvbmdfbmFtZSIsImRlZmZlcmVkIiwicmVzb2x2ZSIsImVycm9yIiwicmVqZWN0IiwibmF2aWdhdG9yIiwiZ2VvbG9jYXRpb24iLCJkZWZlciIsImdldEN1cnJlbnRQb3NpdGlvbiIsInByb21pc2UiLCJzZXJ2aWNlIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUVJLFlBRUFBLFNBQVFDLE9BQU8sWUFBYTtDQ0poQyxXQUVJLFlBTUEsU0FBU0MsR0FBYUMsRUFBZUMsR0FDakNBLEVBQ0tDLFVBQVUsVUFFZkYsRUFFS0csTUFBTSxTQUNIQyxJQUFLLFNBQ0xDLFlBQWEsbUJBQ2JDLFdBQVksNkJBSWZILE1BQU0sUUFDSEMsSUFBSyxRQUNMQyxZQUFhLGtCQUNiQyxXQUFZLCtCQUlmSCxNQUFNLFFBQ0hDLElBQUssUUFDTEMsWUFBYSxrQkFDYkMsV0FBWSx5QkFDWkMsUUFDSUMsS0FBTSxRQTdCdEJYLFFBQVFDLE9BQU8sWUFDVlcsT0FBT1YsR0FFWkEsRUFBYVcsU0FBVyxpQkFBa0I7Q0NQOUMsV0FFSSxZQUVBYixTQUFRQyxPQUFPLFlBRVZhLFNBQVMsaUJBQWtCLG1DQUMzQkEsU0FBUyxZQUFhO0NDUC9CLFdBRUksWUFZQSxTQUFTQyxHQUFnQkMsR0FDckIsR0FBSUMsR0FBT0MsSUFDWEQsR0FBS0UsU0FBV0MsYUFBYUQsVUFBWSxHQUV6Q0YsRUFBS0ksWUFBYyxTQUFVQyxHQUN6QkYsYUFBYUQsU0FBV0csRUFBS0MsUUFBUSxnQkFBZ0IsSUFDckRQLEVBQU9RLEdBQUcsU0FTbEIsUUFBU0MsR0FBbUJULEVBQVFVLEVBQU9DLEVBQWlCQyxHQUN4RCxHQUFJWCxHQUFPQyxJQUNYRCxHQUFLWSxnQkFBaUIsRUFDdEJaLEVBQUtFLFNBQVdDLGFBQWFELFVBQVksR0FDekNGLEVBQUthLGFBQWUsUUFDcEJiLEVBQUtjLHNCQUF3QixRQUM3QmQsRUFBS2UsVUFBWSxHQUdqQmYsRUFBS2dCLEtBQU8sV0FDYyxLQUFsQmhCLEVBQUtFLFVBQ0xILEVBQU9RLEdBQUcsU0FFZFAsRUFBS2lCLFdBR1RqQixFQUFLaUIsUUFBVSxXQUNYUCxFQUFnQlEsVUFDWEMsS0FBSyxTQUFVQyxHQUNacEIsRUFBS2EsYUFBZU8sRUFDcEJwQixFQUFLcUIsY0FBZ0IsS0FFeEJDLE1BQU0sU0FBVUMsR0FDYkMsUUFBUUMsSUFBSUYsR0FDWnZCLEVBQUtxQixjQUFnQix5Q0FDckJyQixFQUFLWSxnQkFBaUIsS0FJbENaLEVBQUswQixVQUFZLFdBQ2JGLFFBQVFDLElBQUksY0FDWkQsUUFBUUMsSUFBSSxXQUFZekIsRUFBS0UsVUFDN0JzQixRQUFRQyxJQUFJLFdBQVl6QixFQUFLYSxjQUM3QlcsUUFBUUMsSUFBSSx3QkFBeUJ6QixFQUFLYyx1QkFDMUNVLFFBQVFDLElBQUksUUFBU3pCLEVBQUtlLFdBRTFCTixFQUFNa0IsS0FBS2hCLEVBQWlCLFlBQ3BCVCxTQUFVRixFQUFLRSxTQUNmVyxhQUE0QyxVQUE3QmIsRUFBS2Msc0JBQ2hCLFFBQVVkLEVBQUthLGFBQ25CRSxVQUE2QixLQUFqQmYsRUFBS2UsVUFDYixRQUFVZixFQUFLZSxVQUFVYSxTQUVoQ1QsS0FBSyxTQUFVVSxHQUNaTCxRQUFRQyxJQUFJSSxFQUFhbkMsTUFDekJLLEVBQU9RLEdBQUcsUUFDTmIsTUFDSW9DLEtBQU1ELEVBQWFuQyxLQUFLb0MsS0FDeEJDLE9BQVFGLEVBQWFuQyxLQUFLcUMsT0FDMUI3QixTQUFVRixFQUFLRSxTQUNmVyxhQUFjYixFQUFLYSxtQkFNdkNiLEVBQUtnQixPQVFULFFBQVNnQixHQUFlakMsRUFBUWtDLEVBQVFDLEdBQ3BDLEdBQUlsQyxHQUFPQyxJQUVORixHQUFPTixPQUFPQyxNQUNmSyxFQUFPUSxHQUFHLFFBR2RQLEVBQUtFLFNBQVdILEVBQU9OLE9BQU9DLEtBQUtRLFNBQ25DRixFQUFLYSxhQUFlZCxFQUFPTixPQUFPQyxLQUFLbUIsYUFDdkNiLEVBQUs4QixLQUFPL0IsRUFBT04sT0FBT0MsS0FBS29DLEtBQy9COUIsRUFBS21DLFFBQVUsR0FDZm5DLEVBQUtvQyxhQUFjLENBRW5CLElBQUlDLEdBQVNDLElBRWJELEdBQU9FLEdBQUcsVUFBVyxXQUVqQkYsRUFBT0csS0FBSyxZQUFhLFlBQWN4QyxFQUFLOEIsUUFJaERPLEVBQU9FLEdBQUcsUUFBUyxTQUFVRSxHQUV6QlIsRUFBT1MsT0FBTyxXQUNWMUMsRUFBS29DLGFBQWMsTUFLM0JwQyxFQUFLMkMsWUFBYyxXQUNmbkIsUUFBUUMsSUFBSSxhQUFjekIsRUFBS21DLFFBRS9CLElBQUlTLElBQ0FDLEtBQU03QyxFQUFLRSxTQUNYNEMsS0FBTTlDLEVBQUttQyxRQUdmRSxHQUFPRyxLQUFLLGVBQWdCSSxHQUM1QjVDLEVBQUttQyxRQUFVLElBSW5CRSxFQUFPRSxHQUFHLGVBQWdCLFNBQVVFLEdBQ2hDakIsUUFBUUMsSUFBSSxZQUFjZ0IsR0FDMUJSLEVBQU9jLFdBQVcsd0JBQXlCTixLQXJJbkQxRCxRQUFRQyxPQUFPLFlBQ1ZRLFdBQVcsa0JBQW1CTSxHQUM5Qk4sV0FBVyxxQkFBc0JnQixHQUNqQ2hCLFdBQVcsaUJBQWtCd0MsR0FNbENsQyxFQUFnQkYsU0FBVyxVQWUzQlksRUFBbUJaLFNBQVcsU0FBVSxRQUFTLGtCQUFtQixrQkFnRXBFb0MsRUFBZXBDLFNBQVcsU0FBVSxTQUFVO0NDNUZsRCxXQUVJLFlBUUEsU0FBU29ELEtBQ0wsT0FDSXpELFlBQWEsK0JBQ2IwRCxVQUNJL0MsU0FBVSxJQUNWVyxhQUFjLE1BSzFCLFFBQVNxQyxLQUNMLE9BQ0kzRCxZQUFhLG1DQUNiQyxXQUFZMkQsRUFDWkYsVUFDSTdDLFlBQWEsSUFDYkYsU0FBVSxNQUt0QixRQUFTaUQsS0FDTCxHQUFJbkQsR0FBT0MsSUFDWEQsR0FBS29ELFlBQWMsU0FBVS9DLEdBQ3pCLE1BQU9BLEdBQUt1QixPQUFPeUIsUUFJM0IsUUFBU0MsS0FDTCxPQUNJL0QsWUFBYSxrQ0FDYjBELFVBQ0l2QixVQUFXLElBQ1hkLGVBQWdCLElBQ2hCMkMsTUFBTyxJQUNQQyxrQkFBbUIsTUFLL0IsUUFBU0MsS0FDTCxPQUNJbEUsWUFBYSxrQ0FDYkMsV0FBWWtFLEVBQ1pULFVBQ0lkLFFBQVMsSUFDVEMsWUFBYSxJQUNiTyxZQUFhLElBQ2J6QyxTQUFVLE1BTXRCLFFBQVN3RCxHQUE0QnpCLEVBQVEwQixHQUN6QyxHQUFJM0QsR0FBT0MsSUFDWEQsR0FBSzRELFFBQVVELEVBQVNFLEtBQUssYUFFN0I1QixFQUFPNkIsSUFBSSx3QkFBeUIsU0FBVUMsRUFBT3JFLEdBQ2pETSxFQUFLZ0UsbUJBQW1CdEUsS0FHNUJNLEVBQUtpRSxlQUFpQixXQUNkakUsRUFBS21DLFFBQVFrQixPQUFTLElBQ3RCckQsRUFBS2tFLHFCQUNMbEUsRUFBSzJDLGdCQUliM0MsRUFBS2dFLG1CQUFxQixTQUFVdkIsR0FDaEMsR0FBSTBCLEdBQU8sR0FBSUMsS0FDZkQsR0FBT0EsRUFBS0UsV0FBYSxJQUFNRixFQUFLRyxhQUFlLElBQU1ILEVBQUtJLGFBRTlEdkUsRUFBSzRELFFBQVFZLE9BQ1QsNERBQ3VDL0IsRUFBSUksS0FBTyxrQ0FDckJKLEVBQUlLLEtBQU8sNENBQ0RxQixFQUFPLGVBR2xEM0MsUUFBUUMsSUFBSSxxQ0FDWkQsUUFBUUMsSUFDSiw0REFDdUNnQixFQUFJSSxLQUFPLGtDQUNyQkosRUFBSUssS0FBTyw0Q0FDRHFCLEVBQU8sZUFHbEQzQyxRQUFRQyxJQUFJLDBDQUNaekIsRUFBSzRELFFBQVEsR0FBR2EsVUFBWXpFLEVBQUs0RCxRQUFRLEdBQUdjLGNBR2hEMUUsRUFBS2tFLG1CQUFxQixXQUN0QixHQUFJQyxHQUFPLEdBQUlDLEtBQ2ZELEdBQU9BLEVBQUtFLFdBQWEsSUFBTUYsRUFBS0csYUFBZSxJQUFNSCxFQUFLSSxhQUU5RHZFLEVBQUs0RCxRQUFRWSxPQUNULDZEQUN1Q3hFLEVBQUtFLFNBQVcsa0NBQzFCRixFQUFLbUMsUUFBVSw0Q0FDTGdDLEVBQU8sZUFHbERuRSxFQUFLNEQsUUFBUSxHQUFHYSxVQUFZekUsRUFBSzRELFFBQVEsR0FBR2MsY0E3R3BEM0YsUUFBUUMsT0FBTyxZQUNWMkYsVUFBVSxZQUFhekIsS0FDdkJ5QixVQUFVLFdBQVlyQixLQUN0QnFCLFVBQVUsaUJBQWtCM0IsS0FDNUIyQixVQUFVLFdBQVlsQixLQXVEM0JDLEVBQTRCOUQsU0FBVyxTQUFVO0NDL0RyRCxXQUVJLFlBVUEsU0FBU2MsR0FBZ0JELEVBQU9tRSxFQUFJQyxHQUNoQyxHQUFJN0UsR0FBT0MsSUFPWEQsR0FBS2tCLFFBQVUsV0FNWCxRQUFTNEQsR0FBUUMsR0FDYnRFLEdBQ0luQixJQUFPdUYsRUFBWUUsRUFBU0MsT0FBT0MsU0FBVyxNQUM5Q0YsRUFBU0MsT0FBT0UsVUFBWSxpQkFDN0IvRCxLQUFLLFNBQVVnRSxHQUVkLEdBQUlDLEdBQWtCRCxFQUFTekYsS0FBSzJGLFFBQ2hDQyxFQUFPLE9BQ1gsS0FBSyxHQUFJQyxLQUFLSCxHQUNWLEdBQTBELGFBQXREQSxFQUFnQkcsR0FBR0MsbUJBQW1CLEdBQUdDLE1BQU0sR0FBbUIsQ0FDbEVILEVBQU9GLEVBQWdCRyxHQUFHQyxtQkFBbUIsR0FBR0UsU0FDaEQsT0FHUkMsRUFBU0MsUUFBUU4sS0FJekIsUUFBU08sR0FBTXRFLEdBQ1hvRSxFQUFTRyxPQUFPdkUsR0F4QnBCLElBQUt3RSxVQUFVQyxZQUNYLE9BQU8sQ0FFWCxJQUFJTCxHQUFXZixFQUFHcUIsT0F3QmxCLE9BdkJBRixXQUFVQyxZQUFZRSxtQkFBbUJwQixFQUFTZSxHQXVCM0NGLEVBQVNRLFNBNUN4QnBILFFBQVFDLE9BQU8sWUFDVm9ILFFBQVEsa0JBQW1CMUYsR0FNaENBLEVBQWdCZCxTQUFXLFFBQVMsS0FBTSIsImZpbGUiOiJjaXR5dGFsay5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJywgWyd1aS5yb3V0ZXInXSk7XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdjaXR5VGFsaycpXG4gICAgICAgIC5jb25maWcoUm91dGVzQ29uZmlnKTtcblxuICAgIFJvdXRlc0NvbmZpZy4kaW5qZWN0ID0gWyckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInXTtcbiAgICBmdW5jdGlvbiBSb3V0ZXNDb25maWcoJHN0YXRlUHJvdmlkZSwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlclxuICAgICAgICAgICAgLm90aGVyd2lzZSgnL3N0YXJ0Jyk7XG5cbiAgICAgICAgJHN0YXRlUHJvdmlkZVxuICAgICAgICAgICAgLy8gU3RhcnQgc2NyZWVuLCB3aGVyZSB1c2VyIGVudGVycyBoaXMgbmFtZVxuICAgICAgICAgICAgLnN0YXRlKCdzdGFydCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvc3RhcnQnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3Mvc3RhcnQuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ3N0YXJ0Q29udHJvbGxlciBhcyBzdGFydCdcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIEZpbmQgc2NyZWVuLCB3aGVyZSBsb2NhdGlvbiBpcyBkZXRlcm1pbmVkIGFuZCB1c2VyIGFkZHMgbGFiZWwgZm9yIGNoYXRcbiAgICAgICAgICAgIC5zdGF0ZSgnZmluZCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvZmluZCcsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9maW5kLmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdmaW5kQ2hhdENvbnRyb2xsZXIgYXMgZmluZCdcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIENoYXQgc3RhdGVcbiAgICAgICAgICAgIC5zdGF0ZSgnY2hhdCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvY2hhdCcsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jaGF0Lmh0bWwnLFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjaGF0Q29udHJvbGxlciBhcyBjaGF0JyxcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogbnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLy8gLmNvbnN0YW50KCdjaXR5dGFsa0FwaVVybCcsICdodHRwOi8vbG9jYWxob3N0OjMwMDAvJylcbiAgICAgICAgLmNvbnN0YW50KCdjaXR5dGFsa0FwaVVybCcsICdodHRwczovL2NpdHl0YWxrLmhlcm9rdWFwcC5jb20vJylcbiAgICAgICAgLmNvbnN0YW50KCdnZW9BcGlVcmwnLCAnaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbj9sYXRsbmc9Jyk7XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdjaXR5VGFsaycpXG4gICAgICAgIC5jb250cm9sbGVyKCdzdGFydENvbnRyb2xsZXInLCBzdGFydENvbnRyb2xsZXIpXG4gICAgICAgIC5jb250cm9sbGVyKCdmaW5kQ2hhdENvbnRyb2xsZXInLCBmaW5kQ2hhdENvbnRyb2xsZXIpXG4gICAgICAgIC5jb250cm9sbGVyKCdjaGF0Q29udHJvbGxlcicsIGNoYXRDb250cm9sbGVyKTtcblxuXG4gICAgLyoqXG4gICAgICogU3RhcnQgc2NyZWVuIGNvbnRyb2xsZXJcbiAgICAgKi9cbiAgICBzdGFydENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHN0YXRlJ107XG4gICAgZnVuY3Rpb24gc3RhcnRDb250cm9sbGVyKCRzdGF0ZSkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNlbGYudXNlck5hbWUgPSBsb2NhbFN0b3JhZ2UudXNlck5hbWUgfHwgJyc7XG5cbiAgICAgICAgc2VsZi5zZXRVc2VyTmFtZSA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UudXNlck5hbWUgPSBuYW1lLnJlcGxhY2UoLyg8KFtePl0rKT4pL2lnLFwiXCIpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdmaW5kJyk7XG4gICAgICAgIH07XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBGaW5kIHNjcmVlbiBjb250cm9sbGVyXG4gICAgICovXG4gICAgZmluZENoYXRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzdGF0ZScsICckaHR0cCcsICdsb2NhdGlvblNlcnZpY2UnLCAnY2l0eXRhbGtBcGlVcmwnXTtcbiAgICBmdW5jdGlvbiBmaW5kQ2hhdENvbnRyb2xsZXIoJHN0YXRlLCAkaHR0cCwgbG9jYXRpb25TZXJ2aWNlLCBjaXR5dGFsa0FwaVVybCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNlbGYubG9jYXRpb25EZW5pZWQgPSBmYWxzZTtcbiAgICAgICAgc2VsZi51c2VyTmFtZSA9IGxvY2FsU3RvcmFnZS51c2VyTmFtZSB8fCAnJztcbiAgICAgICAgc2VsZi51c2VyTG9jYXRpb24gPSAnd29ybGQnO1xuICAgICAgICBzZWxmLnVzZXJQcmVmZXJyZWRMb2NhdGlvbiA9ICd3b3JsZCc7XG4gICAgICAgIHNlbGYudXNlckxhYmVsID0gJyc7XG5cbiAgICAgICAgLy9DaGVjayBpZiB1c2VybmFtZSBzZXQgYW5kIGxvY2F0ZSBjaXR5XG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLnVzZXJOYW1lID09PSAnJykge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnc3RhcnQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuc2V0Q2l0eSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuc2V0Q2l0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxvY2F0aW9uU2VydmljZS5nZXRDaXR5KClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXNlckxvY2F0aW9uID0gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvY2F0aW9uRXJyb3IgPSAnJztcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9jYXRpb25FcnJvciA9ICdBbGxvdyB1c2luZyBsb2NhdGlvbiB0byBmaW5kIHlvdXIgY2l0eSc7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9jYXRpb25EZW5pZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuc3RhcnRDaGF0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3N0YXJ0IGNoYXQnKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1c2VyTmFtZScsIHNlbGYudXNlck5hbWUpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2xvY2F0aW9uJywgc2VsZi51c2VyTG9jYXRpb24pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3VzZXJQcmVmZXJyZWRMb2NhdGlvbicsIHNlbGYudXNlclByZWZlcnJlZExvY2F0aW9uKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsYWJlbCcsIHNlbGYudXNlckxhYmVsKTtcblxuICAgICAgICAgICAgJGh0dHAucG9zdChjaXR5dGFsa0FwaVVybCArICdmaW5kY2hhdCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6IHNlbGYudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHVzZXJMb2NhdGlvbjogKHNlbGYudXNlclByZWZlcnJlZExvY2F0aW9uPT09J3dvcmxkJykgP1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3dvcmxkJyA6IHNlbGYudXNlckxvY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgICB1c2VyTGFiZWw6IChzZWxmLnVzZXJMYWJlbD09PScnKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWwnIDogc2VsZi51c2VyTGFiZWwudHJpbSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZURhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2VEYXRhLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2NoYXQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vbTogcmVzcG9uc2VEYXRhLmRhdGEucm9vbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlRGF0YS5kYXRhLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogc2VsZi51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTG9jYXRpb246IHNlbGYudXNlckxvY2F0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuaW5pdCgpO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogQ2hhdCBjb250cm9sbGVyXG4gICAgICovXG4gICAgY2hhdENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHN0YXRlJywgJyRzY29wZScsICckcm9vdFNjb3BlJ107XG4gICAgZnVuY3Rpb24gY2hhdENvbnRyb2xsZXIoJHN0YXRlLCAkc2NvcGUsICRyb290U2NvcGUpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIGlmICghJHN0YXRlLnBhcmFtcy5kYXRhKSB7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2ZpbmQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbGYudXNlck5hbWUgPSAkc3RhdGUucGFyYW1zLmRhdGEudXNlck5hbWU7XG4gICAgICAgIHNlbGYudXNlckxvY2F0aW9uID0gJHN0YXRlLnBhcmFtcy5kYXRhLnVzZXJMb2NhdGlvbjtcbiAgICAgICAgc2VsZi5yb29tID0gJHN0YXRlLnBhcmFtcy5kYXRhLnJvb207XG4gICAgICAgIHNlbGYubWVzc2FnZSA9ICcnO1xuICAgICAgICBzZWxmLmNoYXRTdGFydGVkID0gZmFsc2U7XG5cbiAgICAgICAgdmFyIHNvY2tldCA9IGlvKCk7XG4gICAgICAgIC8vIENvbm5lY3RcbiAgICAgICAgc29ja2V0Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gQ29ubmVjdGVkLCBsZXQncyBzaWduLXVwIGZvciB0byByZWNlaXZlIG1lc3NhZ2VzIGZvciB0aGlzIHJvb21cbiAgICAgICAgICAgIHNvY2tldC5lbWl0KCdqb2luIHJvb20nLCAndXNlclJvb21fJyArIHNlbGYucm9vbSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFN0YXJ0IGNoYXQoYm90aCBwYXJ0bmVycyBjb25uZWN0ZWQpXG4gICAgICAgIHNvY2tldC5vbignc3RhcnQnLCBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgICAgICAvLyBOb24tYW5ndWxhciBldmVudCwgY2FsbCAkYXBwbHlcbiAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNlbGYuY2hhdFN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNlbmQgbWVzc2FnZVxuICAgICAgICBzZWxmLnNlbmRNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlbmRtZXNhZ2UnLCBzZWxmLm1lc3NhZ2UpO1xuXG4gICAgICAgICAgICB2YXIgbXNnRGF0YSA9IHtcbiAgICAgICAgICAgICAgICB1c2VyOiBzZWxmLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgIHRleHQ6IHNlbGYubWVzc2FnZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ2NoYXQgbWVzc2FnZScsIG1zZ0RhdGEpO1xuICAgICAgICAgICAgc2VsZi5tZXNzYWdlID0gJyc7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gUmVjZWl2ZSBtZXNzYWdlXG4gICAgICAgIHNvY2tldC5vbignY2hhdCBtZXNzYWdlJywgZnVuY3Rpb24gKG1zZykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ21lc3NhZ2U6ICcgKyBtc2cpO1xuICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2NpdHl0YWxrOmluY29taW5nLW1zZycsIG1zZyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2NpdHlUYWxrJylcbiAgICAgICAgLmNvbXBvbmVudCgnc3RhcnRGb3JtJywgc3RhcnRGb3JtQ29tcG9uZW50KCkpXG4gICAgICAgIC5jb21wb25lbnQoJ2ZpbmRGb3JtJywgZmluZEZvcm1Db21wb25lbnQoKSlcbiAgICAgICAgLmNvbXBvbmVudCgnY2l0eVRhbGtIZWFkZXInLCBjaXR5VGFsa0hlYWRlckNvbXBvbmVudCgpKVxuICAgICAgICAuY29tcG9uZW50KCdjaGF0Rm9ybScsIGNoYXRGb3JtQ29tcG9uZW50KCkpO1xuXG4gICAgZnVuY3Rpb24gY2l0eVRhbGtIZWFkZXJDb21wb25lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NvbXBvbmVudHMvaGVhZGVyLmh0bWwnLFxuICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICB1c2VyTmFtZTogJ0AnLFxuICAgICAgICAgICAgICAgIHVzZXJMb2NhdGlvbjogJ0AnXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdGFydEZvcm1Db21wb25lbnQoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2NvbXBvbmVudHMvc3RhcnQtZm9ybS5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IHN0YXJ0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIsXG4gICAgICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgICAgIHNldFVzZXJOYW1lOiAnJicsXG4gICAgICAgICAgICAgICAgdXNlck5hbWU6ICdAJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3RhcnRGb3JtQ29tcG9uZW50Q29udHJvbGxlcigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBzZWxmLmlzTmFtZVZhbGlkID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBuYW1lLnRyaW0oKS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBmaW5kRm9ybUNvbXBvbmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvY29tcG9uZW50cy9maW5kLWZvcm0uaHRtbCcsXG4gICAgICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgICAgIHN0YXJ0Q2hhdDogJyYnLFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uRGVuaWVkOiAnPCcsXG4gICAgICAgICAgICAgICAgbGFiZWw6ICc9JyxcbiAgICAgICAgICAgICAgICBwcmVmZXJyZWRMb2NhdGlvbjogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjaGF0Rm9ybUNvbXBvbmVudCgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvY29tcG9uZW50cy9jaGF0LWZvcm0uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBjaGF0Rm9ybUNvbXBvbmVudENvbnRyb2xsZXIsXG4gICAgICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICc9JyxcbiAgICAgICAgICAgICAgICBjaGF0U3RhcnRlZDogJzwnLFxuICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlOiAnJicsXG4gICAgICAgICAgICAgICAgdXNlck5hbWU6ICdAJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2hhdEZvcm1Db21wb25lbnRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckZWxlbWVudCddO1xuICAgIGZ1bmN0aW9uIGNoYXRGb3JtQ29tcG9uZW50Q29udHJvbGxlcigkc2NvcGUsICRlbGVtZW50KSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi5jaGF0Qm94ID0gJGVsZW1lbnQuZmluZCgnI2NoYXQtYm94Jyk7XG5cbiAgICAgICAgJHNjb3BlLiRvbignY2l0eXRhbGs6aW5jb21pbmctbXNnJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgICBzZWxmLmFkZEluY29taW5nTWVzc2FnZShkYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2VsZi5zZW5kT3V0TWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChzZWxmLm1lc3NhZ2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNlbGYuYWRkT3V0Z29pbmdNZXNzYWdlKCk7XG4gICAgICAgICAgICAgICAgc2VsZi5zZW5kTWVzc2FnZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuYWRkSW5jb21pbmdNZXNzYWdlID0gZnVuY3Rpb24gKG1zZykge1xuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgZGF0ZSA9IGRhdGUuZ2V0SG91cnMoKSArICc6JyArIGRhdGUuZ2V0TWludXRlcygpICsgJzonICsgZGF0ZS5nZXRTZWNvbmRzKCk7XG5cbiAgICAgICAgICAgIHNlbGYuY2hhdEJveC5hcHBlbmQoXG4gICAgICAgICAgICAgICAgJzxwIGNsYXNzPVwibXNnIG1zZy0taW5cIj4nICtcbiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJtc2dfX3VzZXIgdGV4dC1pbmZvXCI+JyArIG1zZy51c2VyICsgJzwvc3Bhbj4nICtcbiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJtc2dfX3RleHRcIj4nICsgbXNnLnRleHQgKyAnPC9zcGFuPicgK1xuICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cIm1zZ19fdGltZSB0ZXh0LWluZm9cIj4nICsgZGF0ZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgJzwvcD4nXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgICAgJzxwIGNsYXNzPVwibXNnIG1zZy0taW5cIj4nICtcbiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJtc2dfX3VzZXIgdGV4dC1pbmZvXCI+JyArIG1zZy51c2VyICsgJzwvc3Bhbj4nICtcbiAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJtc2dfX3RleHRcIj4nICsgbXNnLnRleHQgKyAnPC9zcGFuPicgK1xuICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cIm1zZ19fdGltZSB0ZXh0LWluZm9cIj4nICsgZGF0ZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgJzwvcD4nXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqJyk7XG4gICAgICAgICAgICBzZWxmLmNoYXRCb3hbMF0uc2Nyb2xsVG9wID0gc2VsZi5jaGF0Qm94WzBdLnNjcm9sbEhlaWdodDtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmFkZE91dGdvaW5nTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGRhdGUgPSBkYXRlLmdldEhvdXJzKCkgKyAnOicgKyBkYXRlLmdldE1pbnV0ZXMoKSArICc6JyArIGRhdGUuZ2V0U2Vjb25kcygpO1xuXG4gICAgICAgICAgICBzZWxmLmNoYXRCb3guYXBwZW5kKFxuICAgICAgICAgICAgICAgICc8cCBjbGFzcz1cIm1zZyBtc2ctLW91dFwiPicgK1xuICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cIm1zZ19fdXNlciB0ZXh0LWluZm9cIj4nICsgc2VsZi51c2VyTmFtZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwibXNnX190ZXh0XCI+JyArIHNlbGYubWVzc2FnZSArICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPVwibXNnX190aW1lIHRleHQtaW5mb1wiPicgKyBkYXRlICsgJzwvc3Bhbj4nICtcbiAgICAgICAgICAgICAgICAnPC9wPidcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzZWxmLmNoYXRCb3hbMF0uc2Nyb2xsVG9wID0gc2VsZi5jaGF0Qm94WzBdLnNjcm9sbEhlaWdodDtcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7XG5cbiIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnY2l0eVRhbGsnKVxuICAgICAgICAuc2VydmljZSgnbG9jYXRpb25TZXJ2aWNlJywgbG9jYXRpb25TZXJ2aWNlKTtcblxuXG4gICAgLyoqXG4gICAgICogTG9jYXRpb24gc2VydmljZVxuICAgICAqL1xuICAgIGxvY2F0aW9uU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdnZW9BcGlVcmwnXTtcbiAgICBmdW5jdGlvbiBsb2NhdGlvblNlcnZpY2UoJGh0dHAsICRxLCBnZW9BcGlVcmwpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgY2xpZW50IGNpdHkgYmFzZWQgb24gbmF2aWdhdG9yLmdlb2xvY2F0aW9uIGFuZCBnb29nbGUgZ2VvQXBpXG4gICAgICAgICAqXG4gICAgICAgICAqIEByZXR1cm5zIHByb21pc2VcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0Q2l0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghbmF2aWdhdG9yLmdlb2xvY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGRlZmZlcmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oc3VjY2VzcywgZXJyb3IpO1xuICAgICAgICAgICAgZnVuY3Rpb24gc3VjY2Vzcyhwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICRodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAoIGdlb0FwaVVybCArIHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSArICclMkMnICtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZSArICcmbGFuZ3VhZ2U9ZW4nIClcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBGaW5kIGNpdHkgbmFtZSBpbiB1bm9yZGVyZWQgcmVzdWx0cyBhcnJheVxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2VSZXN1bHRzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2l0eSA9ICd3b3JsZCc7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcmVzcG9uc2VSZXN1bHRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VSZXN1bHRzW2ldLmFkZHJlc3NfY29tcG9uZW50c1swXS50eXBlc1swXSA9PT0gJ2xvY2FsaXR5Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpdHkgPSByZXNwb25zZVJlc3VsdHNbaV0uYWRkcmVzc19jb21wb25lbnRzWzBdLmxvbmdfbmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZXNvbHZlKGNpdHkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBlcnJvcihlcnIpIHtcbiAgICAgICAgICAgICAgICBkZWZmZXJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRlZmZlcmVkLnByb21pc2U7XG4gICAgICAgIH1cbiAgICB9XG5cblxufSkoKTsiXX0=
